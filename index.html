<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barangay Complaint System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
    }
    
    html {
      height: 100%;
    }

    .tab-button {
      transition: all 0.3s ease;
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .complaint-card {
      transition: all 0.2s ease;
    }

    .complaint-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .upvote-button {
      transition: all 0.2s ease;
    }

    .upvote-button:hover {
      transform: scale(1.05);
    }

    .upvote-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body>
  <div id="app" class="min-h-full flex flex-col"></div>
  <script>
   const API_URL = "https://script.google.com/macros/s/AKfycbzPLL0SU4lJSFfjf0plXUNSfl_XqfEbzuVUuZUOz6xaQ6ae8yD7ciFXwoXacckaCsMz/exec";

const dataSdk = {
  create: async (data) => {
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });

    const json = await res.json();
    return { isOk: json.result === "OK", data: json };
  },
  
  update: async () => {
    alert("Update function must be manually added ‚Äî Google Sheets API does not support direct row update without row number.");
  }
};

    const defaultConfig = {
      background_color: "#f0f4f8",
      surface_color: "#ffffff",
      text_color: "#1a202c",
      primary_action_color: "#2563eb",
      secondary_action_color: "#64748b",
      font_family: "Inter",
      font_size: 16,
      barangay_name: "Barangay San Miguel",
      welcome_message: "Welcome to Our Community Portal",
      form_title: "Submit New Complaint",
      submit_button_text: "Submit Complaint"
    };

    let config = { ...defaultConfig };
    let currentTab = 'complaints';
    let allRecords = [];
    let isLoading = false;
    let currentUser = null;
    let authMode = 'login';
    let userType = 'resident';
    let adminTab = 'complaints';
    let statusFilter = 'all';
    let categoryFilter = 'all';
    let dateFilter = 'all';
    let startDate = '';
    let endDate = '';
    let editingAnnouncement = null;
    let editingOfficial = null;
    let editingHotline = null;
    let reportStatusFilter = 'all';
    let reportDateFilter = 'all';
    let reportStartDate = '';
    let reportEndDate = '';

    const categories = [
      'Roads',
      'Garbage Collection',
      'Noise/Disturbance',
      'Drainage',
      'Security',
      'Lighting',
      'Other'
    ];

    const statusTypes = [
      { value: 'submitted', label: 'Submitted', color: '#94a3b8' },
      { value: 'under_review', label: 'Under Review', color: '#60a5fa' },
      { value: 'assigned', label: 'Assigned to Officer', color: '#a78bfa' },
      { value: 'in_progress', label: 'In Progress', color: '#fb923c' },
      { value: 'resolved', label: 'Resolved', color: '#34d399' }
    ];

    // Sheet-specific filter functions
    function getUsers() {
      return allRecords.filter(r => r.__sheet_type === 'accounts');
    }

    function getComplaints() {
      return allRecords.filter(r => r.__sheet_type === 'complaints');
    }

    function getVotes() {
      return allRecords.filter(r => r.__sheet_type === 'votes');
    }

    function getAnnouncements() {
      return allRecords.filter(r => r.__sheet_type === 'announcements').sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    function getOfficials() {
      return allRecords.filter(r => r.__sheet_type === 'officials');
    }

    function getHotlines() {
      return allRecords.filter(r => r.__sheet_type === 'hotlines');
    }

    function hasUserVoted(complaintId, userId) {
      return getVotes().some(v => v.complaint_id === complaintId && v.user_id === userId);
    }

    function getStatusColor(status) {
      const statusObj = statusTypes.find(s => s.value === status);
      return statusObj ? statusObj.color : '#94a3b8';
    }

    function getStatusLabel(status) {
      const statusObj = statusTypes.find(s => s.value === status);
      return statusObj ? statusObj.label : 'Unknown';
    }

    function filterComplaintsByDate(complaints, filterType, start, end) {
      if (filterType === 'all') return complaints;
      
      if (filterType === 'custom' && start && end) {
        const startD = new Date(start);
        startD.setHours(0, 0, 0, 0);
        const endD = new Date(end);
        endD.setHours(23, 59, 59, 999);
        
        return complaints.filter(c => {
          const complaintDate = new Date(c.created_at);
          return complaintDate >= startD && complaintDate <= endD;
        });
      }
      
      const now = new Date();
      const filtered = complaints.filter(c => {
        const complaintDate = new Date(c.created_at);
        const daysDiff = Math.floor((now - complaintDate) / (1000 * 60 * 60 * 24));
        
        if (filterType === 'today') return daysDiff === 0;
        if (filterType === 'week') return daysDiff <= 7;
        if (filterType === 'month') return daysDiff <= 30;
        if (filterType === 'year') return daysDiff <= 365;
        
        return true;
      });
      
      return filtered;
    }

    function generateReportData() {
      let complaints = getComplaints();
      
      if (reportStatusFilter !== 'all') {
        complaints = complaints.filter(c => c.status === reportStatusFilter);
      }
      
      complaints = filterComplaintsByDate(complaints, reportDateFilter, reportStartDate, reportEndDate);
      
      const statusCounts = {};
      statusTypes.forEach(st => {
        statusCounts[st.value] = complaints.filter(c => c.status === st.value).length;
      });
      
      return { statusCounts, total: complaints.length };
    }

    function drawPieChart(canvasId, data) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 40;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const total = data.total;
      if (total === 0) {
        ctx.fillStyle = config.text_color || defaultConfig.text_color;
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('No data to display', centerX, centerY);
        return;
      }
      
      let currentAngle = -Math.PI / 2;
      
      statusTypes.forEach(st => {
        const count = data.statusCounts[st.value];
        if (count > 0) {
          const sliceAngle = (count / total) * 2 * Math.PI;
          
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
          ctx.closePath();
          ctx.fillStyle = st.color;
          ctx.fill();
          
          ctx.strokeStyle = config.surface_color || defaultConfig.surface_color;
          ctx.lineWidth = 2;
          ctx.stroke();
          
          const labelAngle = currentAngle + sliceAngle / 2;
          const labelX = centerX + (radius * 0.7) * Math.cos(labelAngle);
          const labelY = centerY + (radius * 0.7) * Math.sin(labelAngle);
          
          ctx.fillStyle = '#ffffff';
          ctx.font = 'bold 14px sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(count, labelX, labelY);
          
          currentAngle += sliceAngle;
        }
      });
    }

    async function handleLogin(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const username = formData.get('username');
      const password = formData.get('password');
      const adminId = formData.get('admin_id');

      let user;
      if (userType === 'admin') {
        user = getUsers().find(u => u.username === username && u.password === password && u.user_type === 'admin' && u.admin_id === adminId);
      } else {
        user = getUsers().find(u => u.username === username && u.password === password && u.user_type === 'resident');
      }
      
      if (user) {
        currentUser = user;
        showToast('Login successful!', 'success');
        renderUI();
      } else {
        showToast(userType === 'admin' ? 'Invalid credentials or Admin ID' : 'Invalid username or password', 'error');
      }
    }

    async function handleSignup(e) {
      e.preventDefault();
      
      if (allRecords.length >= 999) {
        showToast('System limit reached. Please contact administrator.', 'error');
        return;
      }

      const formData = new FormData(e.target);
      const username = formData.get('username');
      const password = formData.get('password');
      const fullName = formData.get('full_name');
      const adminId = formData.get('admin_id');

      const existingUser = getUsers().find(u => u.username === username);
      
      if (existingUser) {
        showToast('Username already exists. Please choose another.', 'error');
        return;
      }

      const userData = {
        __sheet_type: 'accounts',
        __user_id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        username: username,
        password: password,
        full_name: fullName,
        user_type: userType,
        admin_id: userType === 'admin' ? adminId : '',
        created_at: new Date().toISOString()
      };

      isLoading = true;
      renderUI();

      const result = await dataSdk.create(userData);
      
      isLoading = false;

      if (result.isOk) {
        showToast('Account created successfully! Please login.', 'success');
        authMode = 'login';
        renderUI();
      } else {
        showToast('Failed to create account. Please try again.', 'error');
        renderUI();
      }
    }

    async function handleComplaintSubmit(e) {
      e.preventDefault();
      
      if (allRecords.length >= 999) {
        showToast('Maximum system limit reached. Please contact administrator.', 'error');
        return;
      }

      const formData = new FormData(e.target);
      const complaintData = {
        __sheet_type: 'complaints',
        __complaint_id: `complaint_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        title: formData.get('title'),
        description: formData.get('description'),
        category: formData.get('category'),
        status: 'submitted',
        upvotes: 0,
        created_at: new Date().toISOString(),
        resident_name: currentUser.full_name,
        user_id: currentUser.__user_id
      };

      isLoading = true;
      renderUI();

      const result = await dataSdk.create(complaintData);
      
      isLoading = false;

      if (result.isOk) {
        e.target.reset();
        showToast('Complaint submitted successfully!', 'success');
        currentTab = 'complaints';
        renderUI();
      } else {
        showToast('Failed to submit complaint. Please try again.', 'error');
        renderUI();
      }
    }

    async function handleUpvote(complaintId) {
      if (!currentUser) return;

      if (hasUserVoted(complaintId, currentUser.__user_id)) {
        showToast('You have already voted on this complaint.', 'error');
        return;
      }

      if (allRecords.length >= 999) {
        showToast('System limit reached. Cannot record vote.', 'error');
        return;
      }

      const complaint = getComplaints().find(c => c.__complaint_id === complaintId);
      if (!complaint) return;

      const voteData = {
        __sheet_type: 'votes',
        __vote_id: `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        complaint_id: complaintId,
        user_id: currentUser.__user_id,
        created_at: new Date().toISOString()
      };

      isLoading = true;
      renderUI();

      const voteResult = await dataSdk.create(voteData);
      
      if (voteResult.isOk) {
        const complaintRecord = allRecords.find(r => r.__sheet_type === 'complaints' && r.__complaint_id === complaintId);
        if (complaintRecord) {
          const updatedComplaint = {
            ...complaintRecord,
            upvotes: complaintRecord.upvotes + 1
          };
          
          const updateResult = await dataSdk.update(updatedComplaint);
          
          isLoading = false;
          
          if (updateResult.isOk) {
            showToast('Upvoted successfully!', 'success');
          } else {
            showToast('Failed to update vote count.', 'error');
          }
          renderUI();
        }
      } else {
        isLoading = false;
        showToast('Failed to record vote. Please try again.', 'error');
        renderUI();
      }
    }

    function handleLogout() {
      currentUser = null;
      currentTab = 'complaints';
      adminTab = 'complaints';
      renderUI();
      showToast('Logged out successfully', 'success');
    }

    async function handleStatusUpdate(complaintId, newStatus) {
      const complaint = allRecords.find(r => r.__sheet_type === 'complaints' && r.__complaint_id === complaintId);
      if (!complaint) return;

      const updatedComplaint = {
        ...complaint,
        status: newStatus
      };

      isLoading = true;
      renderUI();

      const result = await dataSdk.update(updatedComplaint);
      
      isLoading = false;

      if (result.isOk) {
        showToast('Complaint status updated!', 'success');
        // Update report chart if we're on reports tab
        if (adminTab === 'reports') {
          setTimeout(() => {
            const reportData = generateReportData();
            drawPieChart('report-chart', reportData);
          }, 100);
        }
      } else {
        showToast('Failed to update status.', 'error');
      }
      renderUI();
    }

    async function handleAnnouncementSubmit(e) {
      e.preventDefault();
      
      if (allRecords.length >= 999) {
        showToast('System limit reached.', 'error');
        return;
      }

      const formData = new FormData(e.target);

      if (editingAnnouncement) {
        const updated = {
          ...editingAnnouncement,
          announcement_title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority'),
          date: formData.get('date')
        };

        isLoading = true;
        renderUI();

        const result = await dataSdk.update(updated);
        
        isLoading = false;

        if (result.isOk) {
          showToast('Announcement updated!', 'success');
          editingAnnouncement = null;
        } else {
          showToast('Failed to update announcement.', 'error');
        }
        renderUI();
      } else {
        const announcementData = {
          __sheet_type: 'announcements',
          __announcement_id: `announcement_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          announcement_title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority'),
          date: formData.get('date'),
          created_at: new Date().toISOString()
        };

        isLoading = true;
        renderUI();

        const result = await dataSdk.create(announcementData);
        
        isLoading = false;

        if (result.isOk) {
          e.target.reset();
          showToast('Announcement created!', 'success');
        } else {
          showToast('Failed to create announcement.', 'error');
        }
        renderUI();
      }
    }

    async function handleDeleteAnnouncement(announcementId) {
      const announcement = allRecords.find(r => r.__sheet_type === 'announcements' && r.__announcement_id === announcementId);
      if (!announcement) return;

      isLoading = true;
      renderUI();

      const result = await dataSdk.delete(announcement);
      
      isLoading = false;

      if (result.isOk) {
        showToast('Announcement deleted!', 'success');
      } else {
        showToast('Failed to delete announcement.', 'error');
      }
      renderUI();
    }

    async function handleOfficialSubmit(e) {
      e.preventDefault();
      
      if (allRecords.length >= 999) {
        showToast('System limit reached.', 'error');
        return;
      }

      const formData = new FormData(e.target);

      if (editingOfficial) {
        const updated = {
          ...editingOfficial,
          official_name: formData.get('name'),
          position: formData.get('position'),
          contact: formData.get('contact')
        };

        isLoading = true;
        renderUI();

        const result = await dataSdk.update(updated);
        
        isLoading = false;

        if (result.isOk) {
          showToast('Official updated!', 'success');
          editingOfficial = null;
        } else {
          showToast('Failed to update official.', 'error');
        }
        renderUI();
      } else {
        const officialData = {
          __sheet_type: 'officials',
          __official_id: `official_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          official_name: formData.get('name'),
          position: formData.get('position'),
          contact: formData.get('contact'),
          created_at: new Date().toISOString()
        };

        isLoading = true;
        renderUI();

        const result = await dataSdk.create(officialData);
        
        isLoading = false;

        if (result.isOk) {
          e.target.reset();
          showToast('Official added!', 'success');
        } else {
          showToast('Failed to add official.', 'error');
        }
        renderUI();
      }
    }

    async function handleDeleteOfficial(officialId) {
      const official = allRecords.find(r => r.__sheet_type === 'officials' && r.__official_id === officialId);
      if (!official) return;

      isLoading = true;
      renderUI();

      const result = await dataSdk.delete(official);
      
      isLoading = false;

      if (result.isOk) {
        showToast('Official removed!', 'success');
      } else {
        showToast('Failed to remove official.', 'error');
      }
      renderUI();
    }

    async function handleHotlineSubmit(e) {
      e.preventDefault();
      
      if (allRecords.length >= 999) {
        showToast('System limit reached.', 'error');
        return;
      }

      const formData = new FormData(e.target);

      if (editingHotline) {
        const updated = {
          ...editingHotline,
          service_name: formData.get('service_name'),
          phone_number: formData.get('phone_number'),
          hotline_description: formData.get('description'),
          available_hours: formData.get('available_hours')
        };

        isLoading = true;
        renderUI();

        const result = await dataSdk.update(updated);
        
        isLoading = false;

        if (result.isOk) {
          showToast('Hotline updated!', 'success');
          editingHotline = null;
        } else {
          showToast('Failed to update hotline.', 'error');
        }
        renderUI();
      } else {
        const hotlineData = {
          __sheet_type: 'hotlines',
          __hotline_id: `hotline_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          service_name: formData.get('service_name'),
          phone_number: formData.get('phone_number'),
          hotline_description: formData.get('description'),
          available_hours: formData.get('available_hours'),
          created_at: new Date().toISOString()
        };

        isLoading = true;
        renderUI();

        const result = await dataSdk.create(hotlineData);
        
        isLoading = false;

        if (result.isOk) {
          e.target.reset();
          showToast('Hotline added!', 'success');
        } else {
          showToast('Failed to add hotline.', 'error');
        }
        renderUI();
      }
    }

    async function handleDeleteHotline(hotlineId) {
      const hotline = allRecords.find(r => r.__sheet_type === 'hotlines' && r.__hotline_id === hotlineId);
      if (!hotline) return;

      isLoading = true;
      renderUI();

      const result = await dataSdk.delete(hotline);
      
      isLoading = false;

      if (result.isOk) {
        showToast('Hotline removed!', 'success');
      } else {
        showToast('Failed to remove hotline.', 'error');
      }
      renderUI();
    }

    function startEditAnnouncement(announcementId) {
      editingAnnouncement = allRecords.find(r => r.__sheet_type === 'announcements' && r.__announcement_id === announcementId);
      renderUI();
    }

    function cancelEditAnnouncement() {
      editingAnnouncement = null;
      renderUI();
    }

    function startEditOfficial(officialId) {
      editingOfficial = allRecords.find(r => r.__sheet_type === 'officials' && r.__official_id === officialId);
      renderUI();
    }

    function cancelEditOfficial() {
      editingOfficial = null;
      renderUI();
    }

    function startEditHotline(hotlineId) {
      editingHotline = allRecords.find(r => r.__sheet_type === 'hotlines' && r.__hotline_id === hotlineId);
      renderUI();
    }

    function cancelEditHotline() {
      editingHotline = null;
      renderUI();
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? '#34d399' : type === 'error' ? '#f87171' : '#60a5fa';
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${bgColor};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        font-weight: 500;
        max-width: 300px;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.transition = 'opacity 0.3s ease';
        toast.style.opacity = '0';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }

    function renderAuthScreen() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      const baseSize = config.font_size || defaultConfig.font_size;

      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      const barangayName = config.barangay_name || defaultConfig.barangay_name;
      const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;

      const authHtml = `
        <div style="background: ${backgroundColor}; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 2rem; font-family: ${fontFamily}; color: ${textColor};">
          <div style="width: 100%; max-width: 450px;">
            <div style="text-align: center; margin-bottom: 2rem;">
              <h1 style="font-size: ${baseSize * 2}px; font-weight: 700; margin: 0 0 0.5rem 0;">${barangayName}</h1>
              <p style="font-size: ${baseSize}px; color: ${secondaryColor}; margin: 0;">${welcomeMessage}</p>
            </div>

            <div style="background: ${surfaceColor}; border-radius: 16px; padding: 2.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
              <div style="margin-bottom: 1.5rem;">
                <div style="display: flex; gap: 0.5rem; background: ${backgroundColor}; padding: 0.25rem; border-radius: 8px;">
                  <button onclick="switchUserType('resident')" style="flex: 1; padding: 0.75rem; border: none; background: ${userType === 'resident' ? surfaceColor : 'transparent'}; color: ${userType === 'resident' ? primaryColor : textColor}; font-weight: ${userType === 'resident' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${userType === 'resident' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    üë§ Resident
                  </button>
                  <button onclick="switchUserType('admin')" style="flex: 1; padding: 0.75rem; border: none; background: ${userType === 'admin' ? surfaceColor : 'transparent'}; color: ${userType === 'admin' ? primaryColor : textColor}; font-weight: ${userType === 'admin' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${userType === 'admin' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    üîë Admin
                  </button>
                </div>
              </div>

              <div style="margin-bottom: 2rem;">
                <div style="display: flex; gap: 0.5rem; background: ${backgroundColor}; padding: 0.25rem; border-radius: 8px;">
                  <button onclick="switchAuthMode('login')" style="flex: 1; padding: 0.75rem; border: none; background: ${authMode === 'login' ? surfaceColor : 'transparent'}; color: ${authMode === 'login' ? primaryColor : textColor}; font-weight: ${authMode === 'login' ? '600' : '500'}; font-size: ${baseSize}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${authMode === 'login' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    Login
                  </button>
                  <button onclick="switchAuthMode('signup')" style="flex: 1; padding: 0.75rem; border: none; background: ${authMode === 'signup' ? surfaceColor : 'transparent'}; color: ${authMode === 'signup' ? primaryColor : textColor}; font-weight: ${authMode === 'signup' ? '600' : '500'}; font-size: ${baseSize}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${authMode === 'signup' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    Sign Up
                  </button>
                </div>
              </div>

              ${authMode === 'login' ? `
                <form id="login-form">
                  <div style="margin-bottom: 1.5rem;">
                    <label for="login-username" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Username</label>
                    <input type="text" id="login-username" name="username" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: ${userType === 'admin' ? '1.5rem' : '2rem'};">
                    <label for="login-password" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                    <input type="password" id="login-password" name="password" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  ${userType === 'admin' ? `
                    <div style="margin-bottom: 2rem;">
                      <label for="login-admin-id" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Admin ID Number</label>
                      <input type="text" id="login-admin-id" name="admin_id" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                    </div>
                  ` : ''}

                  <button type="submit" style="width: 100%; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                    ${isLoading ? 'Logging in...' : 'Login'}
                  </button>
                </form>
              ` : `
                <form id="signup-form">
                  <div style="margin-bottom: 1.5rem;">
                    <label for="signup-fullname" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Full Name</label>
                    <input type="text" id="signup-fullname" name="full_name" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: 1.5rem;">
                    <label for="signup-username" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Username</label>
                    <input type="text" id="signup-username" name="username" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: ${userType === 'admin' ? '1.5rem' : '2rem'};">
                    <label for="signup-password" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                    <input type="password" id="signup-password" name="password" required minlength="6" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                    <p style="font-size: ${baseSize * 0.8}px; color: ${secondaryColor}; margin: 0.5rem 0 0 0;">Minimum 6 characters</p>
                  </div>

                  ${userType === 'admin' ? `
                    <div style="margin-bottom: 2rem;">
                      <label for="signup-admin-id" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Admin ID Number</label>
                      <input type="text" id="signup-admin-id" name="admin_id" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                      <p style="font-size: ${baseSize * 0.8}px; color: ${secondaryColor}; margin: 0.5rem 0 0 0;">Your official admin identification number</p>
                    </div>
                  ` : ''}

                  <button type="submit" style="width: 100%; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                    ${isLoading ? 'Creating Account...' : 'Create Account'}
                  </button>
                </form>
              `}
            </div>
          </div>
        </div>
      `;

      document.getElementById('app').innerHTML = authHtml;

      if (authMode === 'login') {
        const form = document.getElementById('login-form');
        if (form) {
          form.addEventListener('submit', handleLogin);
        }
      } else {
        const form = document.getElementById('signup-form');
        if (form) {
          form.addEventListener('submit', handleSignup);
        }
      }
    }

    function renderUI() {
      if (!currentUser) {
        renderAuthScreen();
        return;
      }

      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      const baseSize = config.font_size || defaultConfig.font_size;

      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      const barangayName = config.barangay_name || defaultConfig.barangay_name;
      const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;
      const formTitle = config.form_title || defaultConfig.form_title;
      const submitButtonText = config.submit_button_text || defaultConfig.submit_button_text;

      const complaints = getComplaints();
      const sortedComplaints = [...complaints].sort((a, b) => b.upvotes - a.upvotes);
      
      const dbAnnouncements = getAnnouncements();
      const dbOfficials = getOfficials();
      const dbHotlines = getHotlines();
      
      let filteredComplaints = complaints;
      if (statusFilter !== 'all') {
        filteredComplaints = filteredComplaints.filter(c => c.status === statusFilter);
      }
      if (categoryFilter !== 'all') {
        filteredComplaints = filteredComplaints.filter(c => c.category === categoryFilter);
      }
      filteredComplaints = filterComplaintsByDate(filteredComplaints, dateFilter, startDate, endDate);

      const isAdmin = currentUser && currentUser.user_type === 'admin';

      const appHtml = `
        <div style="background: ${backgroundColor}; min-height: 100%; font-family: ${fontFamily}; color: ${textColor};">
          <header style="background: ${surfaceColor}; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem 1rem;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
              <div>
                <h1 style="font-size: ${baseSize * 1.75}px; font-weight: 700; margin: 0 0 0.5rem 0;">${barangayName}</h1>
                <p style="font-size: ${baseSize * 0.9}px; margin: 0; color: ${secondaryColor};">${welcomeMessage}</p>
              </div>
              <div style="text-align: right;">
                <p style="font-size: ${baseSize * 0.9}px; margin: 0 0 0.25rem 0; font-weight: 500;">Welcome, ${currentUser.full_name}</p>
                ${isAdmin ? `<p style="font-size: ${baseSize * 0.8}px; margin: 0 0 0.5rem 0; color: ${primaryColor}; font-weight: 600;">üîë Administrator</p>` : ''}
                <button onclick="handleLogout()" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid ${secondaryColor}; color: ${textColor}; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 500; cursor: pointer; font-family: ${fontFamily};">
                  Logout
                </button>
              </div>
            </div>
          </header>

          <nav style="background: ${surfaceColor}; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); padding: 0 1rem;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; gap: 0.5rem; overflow-x: auto;">
              ${isAdmin ? `
                <button class="tab-button" onclick="switchTab('admin')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'admin' ? backgroundColor : 'transparent'}; color: ${currentTab === 'admin' ? primaryColor : textColor}; font-weight: ${currentTab === 'admin' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'admin' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                  ‚öôÔ∏è Admin Dashboard
                </button>
              ` : ''}
              <button class="tab-button" onclick="switchTab('complaints')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'complaints' ? backgroundColor : 'transparent'}; color: ${currentTab === 'complaints' ? primaryColor : textColor}; font-weight: ${currentTab === 'complaints' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'complaints' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                   Complaints
              </button>
              ${!isAdmin ? `
                <button class="tab-button" onclick="switchTab('submit')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'submit' ? backgroundColor : 'transparent'}; color: ${currentTab === 'submit' ? primaryColor : textColor}; font-weight: ${currentTab === 'submit' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'submit' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                  ‚ûï Submit
                </button>
              ` : ''}
              <button class="tab-button" onclick="switchTab('announcements')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'announcements' ? backgroundColor : 'transparent'}; color: ${currentTab === 'announcements' ? primaryColor : textColor}; font-weight: ${currentTab === 'announcements' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'announcements' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üì¢ Announcements
              </button>
              <button class="tab-button" onclick="switchTab('officials')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'officials' ? backgroundColor : 'transparent'}; color: ${currentTab === 'officials' ? primaryColor : textColor}; font-weight: ${currentTab === 'officials' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'officials' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üë• Officials
              </button>
              <button class="tab-button" onclick="switchTab('hotlines')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'hotlines' ? backgroundColor : 'transparent'}; color: ${currentTab === 'hotlines' ? primaryColor : textColor}; font-weight: ${currentTab === 'hotlines' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'hotlines' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üö® Emergency
              </button>
            </div>
          </nav>

          <main style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
            ${currentTab === 'admin' && isAdmin ? renderAdminDashboard(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) : ''}
            ${currentTab === 'complaints' ? renderComplaintsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, sortedComplaints) : ''}
            ${currentTab === 'submit' ? renderSubmitTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, formTitle, submitButtonText) : ''}
            ${currentTab === 'announcements' ? renderAnnouncementsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbAnnouncements) : ''}
            ${currentTab === 'officials' ? renderOfficialsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbOfficials) : ''}
            ${currentTab === 'hotlines' ? renderHotlinesTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbHotlines, isAdmin) : ''}
          </main>
        </div>
      `;

      document.getElementById('app').innerHTML = appHtml;
      attachEventListeners();
      
      if (currentTab === 'admin' && adminTab === 'reports') {
        setTimeout(() => {
          const reportData = generateReportData();
          drawPieChart('report-chart', reportData);
        }, 100);
      }
    }

    function renderAdminDashboard(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) {
      return `
        <div>
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin: 0 0 1.5rem 0;">Admin Dashboard</h2>
          
          <div style="display: flex; gap: 0.5rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <button onclick="switchAdminTab('complaints')" style="padding: 0.75rem 1.5rem; border: 2px solid ${adminTab === 'complaints' ? primaryColor : backgroundColor}; background: ${adminTab === 'complaints' ? primaryColor : surfaceColor}; color: ${adminTab === 'complaints' ? 'white' : textColor}; border-radius: 8px; font-size: ${baseSize * 0.9}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
              Manage Complaints
            </button>
            <button onclick="switchAdminTab('reports')" style="padding: 0.75rem 1.5rem; border: 2px solid ${adminTab === 'reports' ? primaryColor : backgroundColor}; background: ${adminTab === 'reports' ? primaryColor : surfaceColor}; color: ${adminTab === 'reports' ? 'white' : textColor}; border-radius: 8px; font-size: ${baseSize * 0.9}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
              Generate Reports
            </button>
            <button onclick="switchAdminTab('announcements')" style="padding: 0.75rem 1.5rem; border: 2px solid ${adminTab === 'announcements' ? primaryColor : backgroundColor}; background: ${adminTab === 'announcements' ? primaryColor : surfaceColor}; color: ${adminTab === 'announcements' ? 'white' : textColor}; border-radius: 8px; font-size: ${baseSize * 0.9}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
              Manage Announcements
            </button>
            <button onclick="switchAdminTab('officials')" style="padding: 0.75rem 1.5rem; border: 2px solid ${adminTab === 'officials' ? primaryColor : backgroundColor}; background: ${adminTab === 'officials' ? primaryColor : surfaceColor}; color: ${adminTab === 'officials' ? 'white' : textColor}; border-radius: 8px; font-size: ${baseSize * 0.9}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
              Manage Officials
            </button>
            <button onclick="switchAdminTab('hotlines')" style="padding: 0.75rem 1.5rem; border: 2px solid ${adminTab === 'hotlines' ? primaryColor : backgroundColor}; background: ${adminTab === 'hotlines' ? primaryColor : surfaceColor}; color: ${adminTab === 'hotlines' ? 'white' : textColor}; border-radius: 8px; font-size: ${baseSize * 0.9}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
              Manage Hotlines
            </button>
          </div>

          ${adminTab === 'complaints' ? renderAdminComplaints(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) : ''}
          ${adminTab === 'reports' ? renderReportsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
          ${adminTab === 'announcements' ? renderAdminAnnouncements(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
          ${adminTab === 'officials' ? renderAdminOfficials(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
          ${adminTab === 'hotlines' ? renderAdminHotlines(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
        </div>
      `;
    }

    function renderAdminComplaints(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) {
      return `
        <div style="margin-bottom: 1.5rem;">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 0.75rem;">
            <div>
              <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Filter by Status:</label>
              <select onchange="setStatusFilter(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: ${surfaceColor}; box-sizing: border-box;">
                <option value="all" ${statusFilter === 'all' ? 'selected' : ''}>All Statuses</option>
                ${statusTypes.map(st => `<option value="${st.value}" ${statusFilter === st.value ? 'selected' : ''}>${st.label}</option>`).join('')}
              </select>
            </div>
            <div>
              <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Filter by Category:</label>
              <select onchange="setCategoryFilter(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: ${surfaceColor}; box-sizing: border-box;">
                <option value="all" ${categoryFilter === 'all' ? 'selected' : ''}>All Categories</option>
                ${categories.map(cat => `<option value="${cat}" ${categoryFilter === cat ? 'selected' : ''}>${cat}</option>`).join('')}
              </select>
            </div>
            <div>
              <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Filter by Date:</label>
              <select onchange="setDateFilter(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: ${surfaceColor}; box-sizing: border-box;">
                <option value="all" ${dateFilter === 'all' ? 'selected' : ''}>All Time</option>
                <option value="today" ${dateFilter === 'today' ? 'selected' : ''}>Today</option>
                <option value="week" ${dateFilter === 'week' ? 'selected' : ''}>Past Week</option>
                <option value="month" ${dateFilter === 'month' ? 'selected' : ''}>Past Month</option>
                <option value="year" ${dateFilter === 'year' ? 'selected' : ''}>Past Year</option>
                <option value="custom" ${dateFilter === 'custom' ? 'selected' : ''}>Custom Range</option>
              </select>
            </div>
          </div>
          
          ${dateFilter === 'custom' ? `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.75rem;">
              <div>
                <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Start Date:</label>
                <input type="date" id="start-date" value="${startDate}" onchange="setStartDate(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: ${surfaceColor}; box-sizing: border-box;">
              </div>
              <div>
                <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">End Date:</label>
                <input type="date" id="end-date" value="${endDate}" onchange="setEndDate(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: ${surfaceColor}; box-sizing: border-box;">
              </div>
            </div>
          ` : ''}
          
          <p style="font-size: ${baseSize * 0.9}px; color: ${secondaryColor}; margin: 0;">${filteredComplaints.length} complaint(s) found</p>
        </div>

        ${filteredComplaints.length === 0 ? `
          <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
            <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No complaints found.</p>
          </div>
        ` : `
          <div style="display: grid; gap: 1rem;">
            ${filteredComplaints.map(complaint => `
              <div style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; margin-bottom: 1rem;">
                  <div style="flex: 1;">
                    <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0 0 0.5rem 0;">${complaint.title}</h3>
                    <p style="font-size: ${baseSize * 0.85}px; color: ${secondaryColor}; margin: 0;">By ${complaint.resident_name} ‚Ä¢ ${new Date(complaint.created_at).toLocaleDateString()} ‚Ä¢ ${complaint.upvotes} upvotes</p>
                  </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                  <span style="background: ${backgroundColor}; color: ${textColor}; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: ${baseSize * 0.85}px; font-weight: 500;">
                    ${complaint.category}
                  </span>
                </div>

                <p style="font-size: ${baseSize}px; line-height: 1.6; margin: 0 0 1rem 0;">${complaint.description}</p>

                <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                  <label style="font-size: ${baseSize * 0.9}px; font-weight: 600;">Update Status:</label>
                  <select onchange="handleStatusUpdate('${complaint.__complaint_id}', this.value)" style="padding: 0.5rem; border: 2px solid ${backgroundColor}; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-family: ${fontFamily}; color: ${textColor}; background: ${surfaceColor};" ${isLoading ? 'disabled' : ''}>
                    ${statusTypes.map(st => `<option value="${st.value}" ${complaint.status === st.value ? 'selected' : ''}>${st.label}</option>`).join('')}
                  </select>
                </div>
              </div>
            `).join('')}
          </div>
        `}
      `;
    }

    function renderReportsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) {
      const reportData = generateReportData();
      
      return `
        <div>
          <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin: 0 0 1.5rem 0;">Complaints Report</h3>
          
          <div style="background: ${surfaceColor}; border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 2rem;">
            <h4 style="font-size: ${baseSize * 1.1}px; font-weight: 600; margin: 0 0 1rem 0;">Filter Report Data</h4>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
              <div>
                <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Filter by Status:</label>
                <select onchange="setReportStatusFilter(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: white; box-sizing: border-box;">
                  <option value="all" ${reportStatusFilter === 'all' ? 'selected' : ''}>All Statuses</option>
                  ${statusTypes.map(st => `<option value="${st.value}" ${reportStatusFilter === st.value ? 'selected' : ''}>${st.label}</option>`).join('')}
                </select>
              </div>
              
              <div>
                <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Filter by Date:</label>
                <select onchange="setReportDateFilter(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: white; box-sizing: border-box;">
                  <option value="all" ${reportDateFilter === 'all' ? 'selected' : ''}>All Time</option>
                  <option value="today" ${reportDateFilter === 'today' ? 'selected' : ''}>Today</option>
                  <option value="week" ${reportDateFilter === 'week' ? 'selected' : ''}>Past Week</option>
                  <option value="month" ${reportDateFilter === 'month' ? 'selected' : ''}>Past Month</option>
                  <option value="year" ${reportDateFilter === 'year' ? 'selected' : ''}>Past Year</option>
                  <option value="custom" ${reportDateFilter === 'custom' ? 'selected' : ''}>Custom Range</option>
                </select>
              </div>
            </div>
            
            ${reportDateFilter === 'custom' ? `
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                  <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Start Date:</label>
                  <input type="date" value="${reportStartDate}" onchange="setReportStartDate(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: white; box-sizing: border-box;">
                </div>
                <div>
                  <label style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">End Date:</label>
                  <input type="date" value="${reportEndDate}" onchange="setReportEndDate(this.value)" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; background: white; box-sizing: border-box;">
                </div>
              </div>
            ` : ''}
          </div>
          
          <div style="background: ${surfaceColor}; border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
            <h4 style="font-size: ${baseSize * 1.1}px; font-weight: 600; margin: 0 0 1rem 0;">Complaints by Status</h4>
            <p style="font-size: ${baseSize * 0.9}px; color: ${secondaryColor}; margin: 0 0 1.5rem 0;">Total Complaints: ${reportData.total}</p>
            
            <div style="display: flex; justify-content: center; margin-bottom: 2rem;">
              <canvas id="report-chart" width="400" height="400"></canvas>
            </div>
            
            <div style="display: grid; gap: 0.75rem;">
              ${statusTypes.map(st => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: ${backgroundColor}; border-radius: 8px;">
                  <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <div style="width: 1rem; height: 1rem; background: ${st.color}; border-radius: 4px;"></div>
                    <span style="font-size: ${baseSize * 0.95}px; font-weight: 500;">${st.label}</span>
                  </div>
                  <span style="font-size: ${baseSize * 1.1}px; font-weight: 700; color: ${primaryColor};">${reportData.statusCounts[st.value]}</span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function renderAdminAnnouncements(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) {
      const dbAnnouncements = getAnnouncements();
      
      return `
        <div style="background: ${surfaceColor}; border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 2rem;">
          <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin: 0 0 1.5rem 0;">${editingAnnouncement ? 'Edit Announcement' : 'Create New Announcement'}</h3>
          <form id="announcement-form">
            <div style="margin-bottom: 1.5rem;">
              <label for="ann-title" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Title</label>
              <input type="text" id="ann-title" name="title" required value="${editingAnnouncement ? editingAnnouncement.announcement_title : ''}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="ann-content" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Content</label>
              <textarea id="ann-content" name="content" required rows="4" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; resize: vertical; box-sizing: border-box;">${editingAnnouncement ? editingAnnouncement.content : ''}</textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
              <div>
                <label for="ann-priority" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Priority</label>
                <select id="ann-priority" name="priority" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box; background: white;">
                  <option value="normal" ${editingAnnouncement && editingAnnouncement.priority === 'normal' ? 'selected' : ''}>Notice</option>
                  <option value="high" ${editingAnnouncement && editingAnnouncement.priority === 'high' ? 'selected' : ''}>High Priority</option>
                  <option value="emergency" ${editingAnnouncement && editingAnnouncement.priority === 'emergency' ? 'selected' : ''}>Emergency</option>
                </select>
              </div>

              <div>
                <label for="ann-date" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Date</label>
                <input type="date" id="ann-date" name="date" required value="${editingAnnouncement ? editingAnnouncement.date : new Date().toISOString().split('T')[0]}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
              </div>
            </div>

            <div style="display: flex; gap: 0.5rem;">
              <button type="submit" style="flex: 1; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                ${isLoading ? 'Saving...' : editingAnnouncement ? 'Update Announcement' : 'Create Announcement'}
              </button>
              ${editingAnnouncement ? `
                <button type="button" onclick="cancelEditAnnouncement()" style="padding: 1rem 2rem; background: ${backgroundColor}; border: 2px solid ${secondaryColor}; color: ${textColor}; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                  Cancel
                </button>
              ` : ''}
            </div>
          </form>
        </div>

        <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin: 0 0 1rem 0;">Existing Announcements</h3>
        ${dbAnnouncements.length === 0 ? `
          <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
            <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No announcements yet.</p>
          </div>
        ` : `
          <div style="display: grid; gap: 1rem;">
            ${dbAnnouncements.map(ann => {
              const priorityColors = { emergency: '#ef4444', high: '#f59e0b', normal: '#3b82f6' };
              const priorityLabels = { emergency: 'üö® Emergency', high: '‚ö†Ô∏è High Priority', normal: '‚ÑπÔ∏è Notice' };
              return `
                <div style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); border-left: 4px solid ${priorityColors[ann.priority]};">
                  <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; margin-bottom: 0.75rem;">
                    <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0;">${ann.announcement_title}</h3>
                    <span style="background: ${priorityColors[ann.priority]}; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: ${baseSize * 0.8}px; font-weight: 500; white-space: nowrap;">
                      ${priorityLabels[ann.priority]}
                    </span>
                  </div>
                  <p style="font-size: ${baseSize * 0.85}px; color: ${secondaryColor}; margin: 0 0 0.75rem 0;">${new Date(ann.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</p>
                  <p style="font-size: ${baseSize}px; line-height: 1.6; margin: 0 0 1rem 0;">${ann.content}</p>
                  <div style="display: flex; gap: 0.5rem;">
                    <button onclick="startEditAnnouncement('${ann.__announcement_id}')" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid ${primaryColor}; color: ${primaryColor}; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                      Edit
                    </button>
                    <button onclick="handleDeleteAnnouncement('${ann.__announcement_id}')" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid #ef4444; color: #ef4444; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                      Delete
                    </button>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        `}
      `;
    }

    function renderAdminOfficials(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) {
      const dbOfficials = getOfficials();
      
      return `
        <div style="background: ${surfaceColor}; border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 2rem;">
          <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin: 0 0 1.5rem 0;">${editingOfficial ? 'Edit Official' : 'Add New Official'}</h3>
          <form id="official-form">
            <div style="margin-bottom: 1.5rem;">
              <label for="off-name" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Full Name</label>
              <input type="text" id="off-name" name="name" required value="${editingOfficial ? editingOfficial.official_name : ''}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="off-position" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Position</label>
              <input type="text" id="off-position" name="position" required value="${editingOfficial ? editingOfficial.position : ''}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="off-contact" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Email Contact</label>
              <input type="email" id="off-contact" name="contact" required value="${editingOfficial ? editingOfficial.contact : ''}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="display: flex; gap: 0.5rem;">
              <button type="submit" style="flex: 1; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                ${isLoading ? 'Saving...' : editingOfficial ? 'Update Official' : 'Add Official'}
              </button>
              ${editingOfficial ? `
                <button type="button" onclick="cancelEditOfficial()" style="padding: 1rem 2rem; background: ${backgroundColor}; border: 2px solid ${secondaryColor}; color: ${textColor}; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                  Cancel
                </button>
              ` : ''}
            </div>
          </form>
        </div>

        <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin: 0 0 1rem 0;">Current Officials</h3>
        ${dbOfficials.length === 0 ? `
          <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
            <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No officials added yet.</p>
          </div>
        ` : `
          <div style="display: grid; gap: 1rem;">
            ${dbOfficials.map(official => `
              <div style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0 0 0.5rem 0;">${official.official_name}</h3>
                <p style="font-size: ${baseSize * 0.95}px; color: ${primaryColor}; font-weight: 500; margin: 0 0 0.75rem 0;">${official.position}</p>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                  <span style="font-size: ${baseSize * 1.2}px;">üìß</span>
                  <a href="mailto:${official.contact}" style="color: ${secondaryColor}; text-decoration: none; font-size: ${baseSize * 0.9}px;" target="_blank" rel="noopener noreferrer">${official.contact}</a>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                  <button onclick="startEditOfficial('${official.__official_id}')" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid ${primaryColor}; color: ${primaryColor}; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                    Edit
                  </button>
                  <button onclick="handleDeleteOfficial('${official.__official_id}')" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid #ef4444; color: #ef4444; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                    Remove
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        `}
      `;
    }

    function renderAdminHotlines(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) {
      const dbHotlines = getHotlines();
      
      return `
        <div style="background: ${surfaceColor}; border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 2rem;">
          <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin: 0 0 1.5rem 0;">${editingHotline ? 'Edit Hotline' : 'Add Emergency Hotline'}</h3>
          <form id="hotline-form">
            <div style="margin-bottom: 1.5rem;">
              <label for="hot-service" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Service Name</label>
              <input type="text" id="hot-service" name="service_name" required placeholder="e.g., Fire Department" value="${editingHotline ? editingHotline.service_name : ''}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="hot-phone" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Phone Number</label>
              <input type="tel" id="hot-phone" name="phone_number" required placeholder="e.g., 911 or (123) 456-7890" value="${editingHotline ? editingHotline.phone_number : ''}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="hot-desc" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Description</label>
              <textarea id="hot-desc" name="description" required rows="3" placeholder="Brief description of the service" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; resize: vertical; box-sizing: border-box;">${editingHotline ? editingHotline.hotline_description : ''}</textarea>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="hot-hours" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Available Hours</label>
              <input type="text" id="hot-hours" name="available_hours" required placeholder="e.g., 24/7 or Mon-Fri 8AM-5PM" value="${editingHotline ? editingHotline.available_hours : ''}" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="display: flex; gap: 0.5rem;">
              <button type="submit" style="flex: 1; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                ${isLoading ? 'Saving...' : editingHotline ? 'Update Hotline' : 'Add Hotline'}
              </button>
              ${editingHotline ? `
                <button type="button" onclick="cancelEditHotline()" style="padding: 1rem 2rem; background: ${backgroundColor}; border: 2px solid ${secondaryColor}; color: ${textColor}; border-radius: 8px; font-size: ${baseSize}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                  Cancel
                </button>
              ` : ''}
            </div>
          </form>
        </div>

        <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 600; margin: 0 0 1rem 0;">Current Hotlines</h3>
        ${dbHotlines.length === 0 ? `
          <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
            <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No hotlines added yet.</p>
          </div>
        ` : `
          <div style="display: grid; gap: 1rem;">
            ${dbHotlines.map(hotline => `
              <div style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); border-left: 4px solid #ef4444;">
                <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0 0 0.5rem 0;">üö® ${hotline.service_name}</h3>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                  <span style="font-size: ${baseSize * 1.5}px;">üìû</span>
                  <a href="tel:${hotline.phone_number}" style="color: ${primaryColor}; text-decoration: none; font-size: ${baseSize * 1.1}px; font-weight: 600;" target="_blank" rel="noopener noreferrer">${hotline.phone_number}</a>
                </div>
                <p style="font-size: ${baseSize * 0.9}px; color: ${textColor}; margin: 0 0 0.5rem 0; line-height: 1.5;">${hotline.hotline_description}</p>
                <p style="font-size: ${baseSize * 0.85}px; color: ${secondaryColor}; margin: 0 0 1rem 0;">‚è∞ ${hotline.available_hours}</p>
                <div style="display: flex; gap: 0.5rem;">
                  <button onclick="startEditHotline('${hotline.__hotline_id}')" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid ${primaryColor}; color: ${primaryColor}; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                    Edit
                  </button>
                  <button onclick="handleDeleteHotline('${hotline.__hotline_id}')" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid #ef4444; color: #ef4444; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                    Remove
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        `}
      `;
    }

    function renderComplaintsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, sortedComplaints) {
      return `
        <div>
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin: 0 0 1.5rem 0;">Community Complaints</h2>
          ${sortedComplaints.length === 0 ? `
            <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
              <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No complaints submitted yet. Be the first to report an issue!</p>
            </div>
          ` : `
            <div style="display: grid; gap: 1rem;">
              ${sortedComplaints.map(complaint => {
                const userHasVoted = hasUserVoted(complaint.__complaint_id, currentUser.__user_id);
                return `
                  <div class="complaint-card" style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; margin-bottom: 1rem;">
                      <div style="flex: 1;">
                        <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0 0 0.5rem 0;">${complaint.title}</h3>
                        <p style="font-size: ${baseSize * 0.85}px; color: ${secondaryColor}; margin: 0;">By ${complaint.resident_name} ‚Ä¢ ${new Date(complaint.created_at).toLocaleDateString()}</p>
                      </div>
                      <span class="status-badge" style="background: ${getStatusColor(complaint.status)}; color: white; flex-shrink: 0; font-size: ${baseSize * 0.85}px;">
                        ${getStatusLabel(complaint.status)}
                      </span>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                      <span style="background: ${backgroundColor}; color: ${textColor}; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: ${baseSize * 0.85}px; font-weight: 500;">
                        ${complaint.category}
                      </span>
                    </div>

                    <p style="font-size: ${baseSize}px; line-height: 1.6; margin: 0 0 1rem 0;">${complaint.description}</p>

                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                      <button class="upvote-button" onclick="handleUpvote('${complaint.__complaint_id}')" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: ${userHasVoted ? primaryColor : backgroundColor}; border: 2px solid ${primaryColor}; color: ${userHasVoted ? 'white' : primaryColor}; border-radius: 8px; font-size: ${baseSize * 0.9}px; font-weight: 600; cursor: ${userHasVoted || isLoading ? 'not-allowed' : 'pointer'}; font-family: ${fontFamily}; opacity: ${userHasVoted ? '0.7' : '1'};" ${userHasVoted || isLoading ? 'disabled' : ''}>
                        <span style="font-size: ${baseSize * 1.2}px;">üëç</span>
                        <span>${complaint.upvotes}</span>
                      </button>
                      <span style="font-size: ${baseSize * 0.85}px; color: ${secondaryColor};">
                        ${complaint.upvotes === 1 ? '1 person' : `${complaint.upvotes} people`} affected
                        ${userHasVoted ? '(You voted)' : ''}
                      </span>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          `}
        </div>
      `;
    }

    function renderSubmitTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, formTitle, submitButtonText) {
      return `
        <div style="max-width: 700px; margin: 0 auto;">
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin: 0 0 1.5rem 0;">${formTitle}</h2>
          <form id="complaint-form" style="background: ${surfaceColor}; border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
            <div style="margin-bottom: 1.5rem;">
              <label for="category" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Category</label>
              <select id="category" name="category" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box; background: white;">
                ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
              </select>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="title" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Complaint Title</label>
              <input type="text" id="title" name="title" required placeholder="Brief description of the issue" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="description" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Detailed Description</label>
              <textarea id="description" name="description" required rows="5" placeholder="Provide more details about the issue..." style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; resize: vertical; box-sizing: border-box;"></textarea>
            </div>

            <button type="submit" style="width: 100%; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
              ${isLoading ? 'Submitting...' : submitButtonText}
            </button>
          </form>
        </div>
      `;
    }

    function renderAnnouncementsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbAnnouncements) {
      return `
        <div>
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin: 0 0 1.5rem 0;">Official Announcements</h2>
          ${dbAnnouncements.length === 0 ? `
            <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
              <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No announcements yet.</p>
            </div>
          ` : `
            <div style="display: grid; gap: 1rem;">
              ${dbAnnouncements.map(announcement => {
                const priorityColors = {
                  emergency: '#ef4444',
                  high: '#f59e0b',
                  normal: '#3b82f6'
                };
                const priorityLabels = {
                  emergency: 'üö® Emergency',
                  high: '‚ö†Ô∏è High Priority',
                  normal: '‚ÑπÔ∏è Notice'
                };
                return `
                  <div style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); border-left: 4px solid ${priorityColors[announcement.priority]};">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; margin-bottom: 0.75rem;">
                      <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0;">${announcement.announcement_title}</h3>
                      <span style="background: ${priorityColors[announcement.priority]}; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: ${baseSize * 0.8}px; font-weight: 500; white-space: nowrap;">
                        ${priorityLabels[announcement.priority]}
                      </span>
                    </div>
                    <p style="font-size: ${baseSize * 0.85}px; color: ${secondaryColor}; margin: 0 0 0.75rem 0;">${new Date(announcement.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</p>
                    <p style="font-size: ${baseSize}px; line-height: 1.6; margin: 0;">${announcement.content}</p>
                  </div>
                `;
              }).join('')}
            </div>
          `}
        </div>
      `;
    }

    function renderOfficialsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbOfficials) {
      return `
        <div>
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin: 0 0 1.5rem 0;">Barangay Officials Directory</h2>
          ${dbOfficials.length === 0 ? `
            <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
              <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No officials added yet.</p>
            </div>
          ` : `
            <div style="display: grid; gap: 1rem;">
              ${dbOfficials.map(official => `
                <div style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                  <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0 0 0.5rem 0;">${official.official_name}</h3>
                  <p style="font-size: ${baseSize * 0.95}px; color: ${primaryColor}; font-weight: 500; margin: 0 0 0.75rem 0;">${official.position}</p>
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="font-size: ${baseSize * 1.2}px;">üìß</span>
                    <a href="mailto:${official.contact}" style="color: ${secondaryColor}; text-decoration: none; font-size: ${baseSize * 0.9}px;" target="_blank" rel="noopener noreferrer">${official.contact}</a>
                  </div>
                </div>
              `).join('')}
            </div>
          `}
        </div>
      `;
    }

    function renderHotlinesTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbHotlines, isAdmin) {
      return `
        <div>
          <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 600; margin: 0 0 1.5rem 0;">üö® Emergency Hotlines</h2>
          ${dbHotlines.length === 0 ? `
            <div style="background: ${surfaceColor}; border-radius: 12px; padding: 3rem; text-align: center;">
              <p style="font-size: ${baseSize * 1.1}px; color: ${secondaryColor}; margin: 0;">No emergency hotlines available yet.</p>
            </div>
          ` : `
            <div style="display: grid; gap: 1rem;">
              ${dbHotlines.map(hotline => `
                <div style="background: ${surfaceColor}; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); border-left: 4px solid #ef4444;">
                  <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 600; margin: 0 0 0.75rem 0;">üö® ${hotline.service_name}</h3>
                  <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <span style="font-size: ${baseSize * 1.5}px;">üìû</span>
                    <a href="tel:${hotline.phone_number}" style="color: ${primaryColor}; text-decoration: none; font-size: ${baseSize * 1.2}px; font-weight: 700;" target="_blank" rel="noopener noreferrer">${hotline.phone_number}</a>
                  </div>
                  <p style="font-size: ${baseSize * 0.95}px; color: ${textColor}; margin: 0 0 0.5rem 0; line-height: 1.6;">${hotline.hotline_description}</p>
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="font-size: ${baseSize * 1.1}px;">‚è∞</span>
                    <span style="font-size: ${baseSize * 0.9}px; color: ${secondaryColor};">${hotline.available_hours}</span>
                  </div>
                </div>
              `).join('')}
            </div>
          `}
        </div>
      `;
    }

    function attachEventListeners() {
      if (currentTab === 'submit') {
        const form = document.getElementById('complaint-form');
        if (form) {
          form.addEventListener('submit', handleComplaintSubmit);
        }
      }

      if (currentTab === 'admin' && currentUser && currentUser.user_type === 'admin') {
        if (adminTab === 'announcements') {
          const announcementForm = document.getElementById('announcement-form');
          if (announcementForm) {
            announcementForm.addEventListener('submit', handleAnnouncementSubmit);
          }
        } else if (adminTab === 'officials') {
          const officialForm = document.getElementById('official-form');
          if (officialForm) {
            officialForm.addEventListener('submit', handleOfficialSubmit);
          }
        } else if (adminTab === 'hotlines') {
          const hotlineForm = document.getElementById('hotline-form');
          if (hotlineForm) {
            hotlineForm.addEventListener('submit', handleHotlineSubmit);
          }
        }
      }
    }

    function switchTab(tab) {
      currentTab = tab;
      renderUI();
    }

    function switchAuthMode(mode) {
      authMode = mode;
      renderUI();
    }

    function switchUserType(type) {
      userType = type;
      renderUI();
    }

    function switchAdminTab(tab) {
      adminTab = tab;
      editingAnnouncement = null;
      editingOfficial = null;
      editingHotline = null;
      renderUI();
    }

    function setStatusFilter(filter) {
      statusFilter = filter;
      renderUI();
    }

    function setCategoryFilter(filter) {
      categoryFilter = filter;
      renderUI();
    }

    function setDateFilter(filter) {
      dateFilter = filter;
      if (filter !== 'custom') {
        startDate = '';
        endDate = '';
      }
      renderUI();
    }

    function setStartDate(date) {
      startDate = date;
      renderUI();
    }

    function setEndDate(date) {
      endDate = date;
      renderUI();
    }

    function setReportStatusFilter(filter) {
      reportStatusFilter = filter;
      renderUI();
    }

    function setReportDateFilter(filter) {
      reportDateFilter = filter;
      if (filter !== 'custom') {
        reportStartDate = '';
        reportEndDate = '';
      }
      renderUI();
    }

    function setReportStartDate(date) {
      reportStartDate = date;
      renderUI();
    }

    function setReportEndDate(date) {
      reportEndDate = date;
      renderUI();
    }

    window.switchTab = switchTab;
    window.switchAuthMode = switchAuthMode;
    window.switchUserType = switchUserType;
    window.switchAdminTab = switchAdminTab;
    window.setStatusFilter = setStatusFilter;
    window.setCategoryFilter = setCategoryFilter;
    window.setDateFilter = setDateFilter;
    window.setStartDate = setStartDate;
    window.setEndDate = setEndDate;
    window.setReportStatusFilter = setReportStatusFilter;
    window.setReportDateFilter = setReportDateFilter;
    window.setReportStartDate = setReportStartDate;
    window.setReportEndDate = setReportEndDate;
    window.handleUpvote = handleUpvote;
    window.handleLogout = handleLogout;
    window.handleStatusUpdate = handleStatusUpdate;
    window.handleDeleteAnnouncement = handleDeleteAnnouncement;
    window.handleDeleteOfficial = handleDeleteOfficial;
    window.handleDeleteHotline = handleDeleteHotline;
    window.startEditAnnouncement = startEditAnnouncement;
    window.cancelEditAnnouncement = cancelEditAnnouncement;
    window.startEditOfficial = startEditOfficial;
    window.cancelEditOfficial = cancelEditOfficial;
    window.startEditHotline = startEditHotline;
    window.cancelEditHotline = cancelEditHotline;

    const dataHandler = {
      onDataChanged(data) {
        allRecords = data;
        renderUI();
      }
    };

    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      renderUI();
    }

    async function init() {
      const initResult = await dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize Data SDK");
        return;
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["barangay_name", config.barangay_name || defaultConfig.barangay_name],
            ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
            ["form_title", config.form_title || defaultConfig.form_title],
            ["submit_button_text", config.submit_button_text || defaultConfig.submit_button_text]
          ])
        });
      }

      renderUI();
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a6aa7673529bc5b',t:'MTc2NDUwODk1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
