<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barangay Complaint System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
    }
    
    html {
      height: 100%;
    }

    .tab-button {
      transition: all 0.3s ease;
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .complaint-card {
      transition: all 0.2s ease;
    }

    .complaint-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .upvote-button {
      transition: all 0.2s ease;
    }

    .upvote-button:hover {
      transform: scale(1.05);
    }

    .upvote-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div id="app" class="min-h-full flex flex-col"></div>
  <div id="loading-overlay" style="display: none;" class="loading-overlay">
   <div class="spinner"></div>
  </div>
  <script>
    // ‚≠ê PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL HERE ‚≠ê
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzPDOWWWqTLcm_YzidaYM3wXj33OpyLY0NGbZN53zYIjM6oT_ZPnxLTL7S3ylZQck8/exec';
    // Example: 'https://script.google.com/macros/s/AKfycbx.../exec'

    const config = {
      background_color: "#f0f4f8",
      surface_color: "#ffffff",
      text_color: "#1a202c",
      primary_action_color: "#2563eb",
      secondary_action_color: "#64748b",
      font_family: "Inter",
      font_size: 16,
      barangay_name: "Barangay San Miguel",
      welcome_message: "Welcome to Our Community Portal",
      form_title: "Submit New Complaint",
      submit_button_text: "Submit Complaint"
    };

    let currentTab = 'complaints';
    let allRecords = [];
    let isLoading = false;
    let currentUser = null;
    let authMode = 'login';
    let userType = 'resident';
    let adminTab = 'complaints';
    let statusFilter = 'all';
    let categoryFilter = 'all';
    let dateFilter = 'all';
    let startDate = '';
    let endDate = '';
    let editingAnnouncement = null;
    let editingOfficial = null;
    let editingHotline = null;
    let reportStatusFilter = 'all';
    let reportDateFilter = 'all';
    let reportStartDate = '';
    let reportEndDate = '';

    const categories = [
      'Roads',
      'Garbage Collection',
      'Noise/Disturbance',
      'Drainage',
      'Security',
      'Lighting',
      'Other'
    ];

    const statusTypes = [
      { value: 'submitted', label: 'Submitted', color: '#94a3b8' },
      { value: 'under_review', label: 'Under Review', color: '#60a5fa' },
      { value: 'assigned', label: 'Assigned to Officer', color: '#a78bfa' },
      { value: 'in_progress', label: 'In Progress', color: '#fb923c' },
      { value: 'resolved', label: 'Resolved', color: '#34d399' }
    ];

    // Google Sheets API functions
    function showLoadingOverlay() {
      document.getElementById('loading-overlay').style.display = 'flex';
    }

    function hideLoadingOverlay() {
      document.getElementById('loading-overlay').style.display = 'none';
    }

    async function loadData() {
      try {
        showLoadingOverlay();
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'loadAll' })
        });
        const result = await response.json();
        hideLoadingOverlay();
        return result.success ? result.data : [];
      } catch(error) {
        console.error('Error loading data:', error);
        hideLoadingOverlay();
        showToast('Failed to load data from server', 'error');
        return [];
      }
    }

    async function createRecord(record) {
      try {
        isLoading = true;
        showLoadingOverlay();
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'create', record: record })
        });
        const result = await response.json();
        
        if (result.success) {
          allRecords = await loadData();
        } else {
          showToast('Error: ' + result.error, 'error');
        }
        
        isLoading = false;
        hideLoadingOverlay();
        return result.success;
      } catch(error) {
        console.error('Error creating record:', error);
        isLoading = false;
        hideLoadingOverlay();
        showToast('Failed to save data', 'error');
        return false;
      }
    }

    async function updateRecord(recordId, sheetType, updates) {
      try {
        isLoading = true;
        showLoadingOverlay();
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'update', recordId, sheetType, updates })
        });
        const result = await response.json();
        
        if (result.success) {
          allRecords = await loadData();
        } else {
          showToast('Error: ' + result.error, 'error');
        }
        
        isLoading = false;
        hideLoadingOverlay();
        return result.success;
      } catch(error) {
        console.error('Error updating record:', error);
        isLoading = false;
        hideLoadingOverlay();
        showToast('Failed to update data', 'error');
        return false;
      }
    }

    async function deleteRecord(recordId, sheetType) {
      try {
        isLoading = true;
        showLoadingOverlay();
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'delete', recordId, sheetType })
        });
        const result = await response.json();
        
        if (result.success) {
          allRecords = await loadData();
        } else {
          showToast('Error: ' + result.error, 'error');
        }
        
        isLoading = false;
        hideLoadingOverlay();
        return result.success;
      } catch(error) {
        console.error('Error deleting record:', error);
        isLoading = false;
        hideLoadingOverlay();
        showToast('Failed to delete data', 'error');
        return false;
      }
    }

    // Sheet-specific filter functions
    function getUsers() {
      return allRecords.filter(r => r.__sheet_type === 'accounts');
    }

    function getComplaints() {
      return allRecords.filter(r => r.__sheet_type === 'complaints');
    }

    function getVotes() {
      return allRecords.filter(r => r.__sheet_type === 'votes');
    }

    function getAnnouncements() {
      return allRecords.filter(r => r.__sheet_type === 'announcements').sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    function getOfficials() {
      return allRecords.filter(r => r.__sheet_type === 'officials');
    }

    function getHotlines() {
      return allRecords.filter(r => r.__sheet_type === 'hotlines');
    }

    function hasUserVoted(complaintId, userId) {
      return getVotes().some(v => v.complaint_id === complaintId && v.user_id === userId);
    }

    function getStatusColor(status) {
      const statusObj = statusTypes.find(s => s.value === status);
      return statusObj ? statusObj.color : '#94a3b8';
    }

    function getStatusLabel(status) {
      const statusObj = statusTypes.find(s => s.value === status);
      return statusObj ? statusObj.label : 'Unknown';
    }

    function filterComplaintsByDate(complaints, filterType, start, end) {
      if (filterType === 'all') return complaints;
      
      if (filterType === 'custom' && start && end) {
        const startD = new Date(start);
        startD.setHours(0, 0, 0, 0);
        const endD = new Date(end);
        endD.setHours(23, 59, 59, 999);
        
        return complaints.filter(c => {
          const complaintDate = new Date(c.created_at);
          return complaintDate >= startD && complaintDate <= endD;
        });
      }
      
      const now = new Date();
      const filtered = complaints.filter(c => {
        const complaintDate = new Date(c.created_at);
        const daysDiff = Math.floor((now - complaintDate) / (1000 * 60 * 60 * 24));
        
        if (filterType === 'today') return daysDiff === 0;
        if (filterType === 'week') return daysDiff <= 7;
        if (filterType === 'month') return daysDiff <= 30;
        if (filterType === 'year') return daysDiff <= 365;
        
        return true;
      });
      
      return filtered;
    }

    function generateReportData() {
      let complaints = getComplaints();
      
      if (reportStatusFilter !== 'all') {
        complaints = complaints.filter(c => c.status === reportStatusFilter);
      }
      
      complaints = filterComplaintsByDate(complaints, reportDateFilter, reportStartDate, reportEndDate);
      
      const statusCounts = {};
      statusTypes.forEach(st => {
        statusCounts[st.value] = complaints.filter(c => c.status === st.value).length;
      });
      
      return { statusCounts, total: complaints.length };
    }

    function drawPieChart(canvasId, data) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 40;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const total = data.total;
      if (total === 0) {
        ctx.fillStyle = config.text_color;
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('No data to display', centerX, centerY);
        return;
      }
      
      let currentAngle = -Math.PI / 2;
      
      statusTypes.forEach(st => {
        const count = data.statusCounts[st.value];
        if (count > 0) {
          const sliceAngle = (count / total) * 2 * Math.PI;
          
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
          ctx.closePath();
          ctx.fillStyle = st.color;
          ctx.fill();
          
          ctx.strokeStyle = config.surface_color;
          ctx.lineWidth = 2;
          ctx.stroke();
          
          const labelAngle = currentAngle + sliceAngle / 2;
          const labelX = centerX + (radius * 0.7) * Math.cos(labelAngle);
          const labelY = centerY + (radius * 0.7) * Math.sin(labelAngle);
          
          ctx.fillStyle = '#ffffff';
          ctx.font = 'bold 14px sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(count, labelX, labelY);
          
          currentAngle += sliceAngle;
        }
      });
    }

    async function handleLogin(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const username = formData.get('username');
      const password = formData.get('password');
      const adminId = formData.get('admin_id');

      let user;
      if (userType === 'admin') {
        user = getUsers().find(u => u.username === username && u.password === password && u.user_type === 'admin' && u.admin_id === adminId);
      } else {
        user = getUsers().find(u => u.username === username && u.password === password && u.user_type === 'resident');
      }
      
      if (user) {
        currentUser = user;
        showToast('Login successful!', 'success');
        renderUI();
      } else {
        showToast(userType === 'admin' ? 'Invalid credentials or Admin ID' : 'Invalid username or password', 'error');
      }
    }

    async function handleSignup(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const username = formData.get('username');
      const password = formData.get('password');
      const fullName = formData.get('full_name');
      const adminId = formData.get('admin_id');

      const existingUser = getUsers().find(u => u.username === username);
      
      if (existingUser) {
        showToast('Username already exists. Please choose another.', 'error');
        return;
      }

      const userData = {
        __sheet_type: 'accounts',
        __user_id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        username: username,
        password: password,
        full_name: fullName,
        user_type: userType,
        admin_id: userType === 'admin' ? adminId : '',
        created_at: new Date().toISOString()
      };

      const success = await createRecord(userData);
      if (success) {
        showToast('Account created successfully! Please login.', 'success');
        authMode = 'login';
        renderUI();
      }
    }

    async function handleComplaintSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const complaintData = {
        __sheet_type: 'complaints',
        __complaint_id: `complaint_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        title: formData.get('title'),
        description: formData.get('description'),
        category: formData.get('category'),
        status: 'submitted',
        upvotes: 0,
        created_at: new Date().toISOString(),
        resident_name: currentUser.full_name,
        user_id: currentUser.__user_id
      };

      const success = await createRecord(complaintData);
      if (success) {
        e.target.reset();
        showToast('Complaint submitted successfully!', 'success');
        currentTab = 'complaints';
        renderUI();
      }
    }

    async function handleUpvote(complaintId) {
      if (!currentUser) return;

      if (hasUserVoted(complaintId, currentUser.__user_id)) {
        showToast('You have already voted on this complaint.', 'error');
        return;
      }

      const complaint = getComplaints().find(c => c.__complaint_id === complaintId);
      if (!complaint) return;

      const voteData = {
        __sheet_type: 'votes',
        __vote_id: `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        complaint_id: complaintId,
        user_id: currentUser.__user_id,
        created_at: new Date().toISOString()
      };

      const voteSuccess = await createRecord(voteData);
      if (voteSuccess) {
        const updateSuccess = await updateRecord(complaintId, 'complaints', { upvotes: complaint.upvotes + 1 });
        if (updateSuccess) {
          showToast('Upvoted successfully!', 'success');
          renderUI();
        }
      }
    }

    function handleLogout() {
      currentUser = null;
      currentTab = 'complaints';
      adminTab = 'complaints';
      renderUI();
      showToast('Logged out successfully', 'success');
    }

    async function handleStatusUpdate(complaintId, newStatus) {
      const success = await updateRecord(complaintId, 'complaints', { status: newStatus });
      if (success) {
        showToast('Complaint status updated!', 'success');
        
        if (adminTab === 'reports') {
          setTimeout(() => {
            const reportData = generateReportData();
            drawPieChart('report-chart', reportData);
          }, 100);
        }
        
        renderUI();
      }
    }

    async function handleAnnouncementSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);

      if (editingAnnouncement) {
        const success = await updateRecord(editingAnnouncement.__announcement_id, 'announcements', {
          announcement_title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority'),
          date: formData.get('date')
        });
        if (success) {
          showToast('Announcement updated!', 'success');
          editingAnnouncement = null;
          renderUI();
        }
      } else {
        const announcementData = {
          __sheet_type: 'announcements',
          __announcement_id: `announcement_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          announcement_title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority'),
          date: formData.get('date'),
          created_at: new Date().toISOString()
        };

        const success = await createRecord(announcementData);
        if (success) {
          e.target.reset();
          showToast('Announcement created!', 'success');
          renderUI();
        }
      }
    }

    async function handleDeleteAnnouncement(announcementId) {
      const success = await deleteRecord(announcementId, 'announcements');
      if (success) {
        showToast('Announcement deleted!', 'success');
        renderUI();
      }
    }

    async function handleOfficialSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);

      if (editingOfficial) {
        const success = await updateRecord(editingOfficial.__official_id, 'officials', {
          official_name: formData.get('name'),
          position: formData.get('position'),
          contact: formData.get('contact')
        });
        if (success) {
          showToast('Official updated!', 'success');
          editingOfficial = null;
          renderUI();
        }
      } else {
        const officialData = {
          __sheet_type: 'officials',
          __official_id: `official_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          official_name: formData.get('name'),
          position: formData.get('position'),
          contact: formData.get('contact'),
          created_at: new Date().toISOString()
        };

        const success = await createRecord(officialData);
        if (success) {
          e.target.reset();
          showToast('Official added!', 'success');
          renderUI();
        }
      }
    }

    async function handleDeleteOfficial(officialId) {
      const success = await deleteRecord(officialId, 'officials');
      if (success) {
        showToast('Official removed!', 'success');
        renderUI();
      }
    }

    async function handleHotlineSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);

      if (editingHotline) {
        const success = await updateRecord(editingHotline.__hotline_id, 'hotlines', {
          service_name: formData.get('service_name'),
          phone_number: formData.get('phone_number'),
          hotline_description: formData.get('description'),
          available_hours: formData.get('available_hours')
        });
        if (success) {
          showToast('Hotline updated!', 'success');
          editingHotline = null;
          renderUI();
        }
      } else {
        const hotlineData = {
          __sheet_type: 'hotlines',
          __hotline_id: `hotline_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          service_name: formData.get('service_name'),
          phone_number: formData.get('phone_number'),
          hotline_description: formData.get('description'),
          available_hours: formData.get('available_hours'),
          created_at: new Date().toISOString()
        };

        const success = await createRecord(hotlineData);
        if (success) {
          e.target.reset();
          showToast('Hotline added!', 'success');
          renderUI();
        }
      }
    }

    async function handleDeleteHotline(hotlineId) {
      const success = await deleteRecord(hotlineId, 'hotlines');
      if (success) {
        showToast('Hotline removed!', 'success');
        renderUI();
      }
    }

    function startEditAnnouncement(announcementId) {
      editingAnnouncement = allRecords.find(r => r.__sheet_type === 'announcements' && r.__announcement_id === announcementId);
      renderUI();
    }

    function cancelEditAnnouncement() {
      editingAnnouncement = null;
      renderUI();
    }

    function startEditOfficial(officialId) {
      editingOfficial = allRecords.find(r => r.__sheet_type === 'officials' && r.__official_id === officialId);
      renderUI();
    }

    function cancelEditOfficial() {
      editingOfficial = null;
      renderUI();
    }

    function startEditHotline(hotlineId) {
      editingHotline = allRecords.find(r => r.__sheet_type === 'hotlines' && r.__hotline_id === hotlineId);
      renderUI();
    }

    function cancelEditHotline() {
      editingHotline = null;
      renderUI();
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? '#34d399' : type === 'error' ? '#f87171' : '#60a5fa';
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${bgColor};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 10000;
        font-weight: 500;
        max-width: 300px;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.transition = 'opacity 0.3s ease';
        toast.style.opacity = '0';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }

    function renderAuthScreen() {
      const customFont = config.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      const baseSize = config.font_size;

      const backgroundColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;

      const barangayName = config.barangay_name;
      const welcomeMessage = config.welcome_message;

      const authHtml = `
        <div style="background: ${backgroundColor}; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 2rem; font-family: ${fontFamily}; color: ${textColor};">
          <div style="width: 100%; max-width: 450px;">
            <div style="text-align: center; margin-bottom: 2rem;">
              <h1 style="font-size: ${baseSize * 2}px; font-weight: 700; margin: 0 0 0.5rem 0;">${barangayName}</h1>
              <p style="font-size: ${baseSize}px; color: ${secondaryColor}; margin: 0;">${welcomeMessage}</p>
            </div>

            <div style="background: ${surfaceColor}; border-radius: 16px; padding: 2.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
              <div style="margin-bottom: 1.5rem;">
                <div style="display: flex; gap: 0.5rem; background: ${backgroundColor}; padding: 0.25rem; border-radius: 8px;">
                  <button onclick="switchUserType('resident')" style="flex: 1; padding: 0.75rem; border: none; background: ${userType === 'resident' ? surfaceColor : 'transparent'}; color: ${userType === 'resident' ? primaryColor : textColor}; font-weight: ${userType === 'resident' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${userType === 'resident' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    üë§ Resident
                  </button>
                  <button onclick="switchUserType('admin')" style="flex: 1; padding: 0.75rem; border: none; background: ${userType === 'admin' ? surfaceColor : 'transparent'}; color: ${userType === 'admin' ? primaryColor : textColor}; font-weight: ${userType === 'admin' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${userType === 'admin' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    üîë Admin
                  </button>
                </div>
              </div>

              <div style="margin-bottom: 2rem;">
                <div style="display: flex; gap: 0.5rem; background: ${backgroundColor}; padding: 0.25rem; border-radius: 8px;">
                  <button onclick="switchAuthMode('login')" style="flex: 1; padding: 0.75rem; border: none; background: ${authMode === 'login' ? surfaceColor : 'transparent'}; color: ${authMode === 'login' ? primaryColor : textColor}; font-weight: ${authMode === 'login' ? '600' : '500'}; font-size: ${baseSize}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${authMode === 'login' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    Login
                  </button>
                  <button onclick="switchAuthMode('signup')" style="flex: 1; padding: 0.75rem; border: none; background: ${authMode === 'signup' ? surfaceColor : 'transparent'}; color: ${authMode === 'signup' ? primaryColor : textColor}; font-weight: ${authMode === 'signup' ? '600' : '500'}; font-size: ${baseSize}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${authMode === 'signup' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    Sign Up
                  </button>
                </div>
              </div>

              ${authMode === 'login' ? `
                <form id="login-form">
                  <div style="margin-bottom: 1.5rem;">
                    <label for="login-username" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Username</label>
                    <input type="text" id="login-username" name="username" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: ${userType === 'admin' ? '1.5rem' : '2rem'};">
                    <label for="login-password" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                    <input type="password" id="login-password" name="password" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  ${userType === 'admin' ? `
                    <div style="margin-bottom: 2rem;">
                      <label for="login-admin-id" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Admin ID Number</label>
                      <input type="text" id="login-admin-id" name="admin_id" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                    </div>
                  ` : ''}

                  <button type="submit" style="width: 100%; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                    ${isLoading ? 'Logging in...' : 'Login'}
                  </button>
                </form>
              ` : `
                <form id="signup-form">
                  <div style="margin-bottom: 1.5rem;">
                    <label for="signup-fullname" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Full Name</label>
                    <input type="text" id="signup-fullname" name="full_name" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: 1.5rem;">
                    <label for="signup-username" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Username</label>
                    <input type="text" id="signup-username" name="username" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: ${userType === 'admin' ? '1.5rem' : '2rem'};">
                    <label for="signup-password" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                    <input type="password" id="signup-password" name="password" required minlength="6" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                    <p style="font-size: ${baseSize * 0.8}px; color: ${secondaryColor}; margin: 0.5rem 0 0 0;">Minimum 6 characters</p>
                  </div>

                  ${userType === 'admin' ? `
                    <div style="margin-bottom: 2rem;">
                      <label for="signup-admin-id" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Admin ID Number</label>
                      <input type="text" id="signup-admin-id" name="admin_id" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                      <p style="font-size: ${baseSize * 0.8}px; color: ${secondaryColor}; margin: 0.5rem 0 0 0;">Your official admin identification number</p>
                    </div>
                  ` : ''}

                  <button type="submit" style="width: 100%; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};" ${isLoading ? 'disabled' : ''}>
                    ${isLoading ? 'Creating Account...' : 'Create Account'}
                  </button>
                </form>
              `}
            </div>
          </div>
        </div>
      `;

      document.getElementById('app').innerHTML = authHtml;

      if (authMode === 'login') {
        const form = document.getElementById('login-form');
        if (form) {
          form.addEventListener('submit', handleLogin);
        }
      } else {
        const form = document.getElementById('signup-form');
        if (form) {
          form.addEventListener('submit', handleSignup);
        }
      }
    }

    // [CONTINUING WITH THE REST OF THE RENDER FUNCTIONS - KEEPING ALL YOUR EXISTING UI CODE]
    // I'll include the rest in the next part to stay within length limits...

    function renderUI() {
      if (!currentUser) {
        renderAuthScreen();
        return;
      }

      const customFont = config.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      const baseSize = config.font_size;

      const backgroundColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;

      const barangayName = config.barangay_name;
      const welcomeMessage = config.welcome_message;
      const formTitle = config.form_title;
      const submitButtonText = config.submit_button_text;

      const complaints = getComplaints();
      const sortedComplaints = [...complaints].sort((a, b) => b.upvotes - a.upvotes);
      
      const dbAnnouncements = getAnnouncements();
      const dbOfficials = getOfficials();
      const dbHotlines = getHotlines();
      
      let filteredComplaints = complaints;
      if (statusFilter !== 'all') {
        filteredComplaints = filteredComplaints.filter(c => c.status === statusFilter);
      }
      if (categoryFilter !== 'all') {
        filteredComplaints = filteredComplaints.filter(c => c.category === categoryFilter);
      }
      filteredComplaints = filterComplaintsByDate(filteredComplaints, dateFilter, startDate, endDate);

      const isAdmin = currentUser && currentUser.user_type === 'admin';

      const appHtml = `
        <div style="background: ${backgroundColor}; min-height: 100%; font-family: ${fontFamily}; color: ${textColor};">
          <header style="background: ${surfaceColor}; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem 1rem;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
              <div>
                <h1 style="font-size: ${baseSize * 1.75}px; font-weight: 700; margin: 0 0 0.5rem 0;">${barangayName}</h1>
                <p style="font-size: ${baseSize * 0.9}px; margin: 0; color: ${secondaryColor};">${welcomeMessage}</p>
              </div>
              <div style="text-align: right;">
                <p style="font-size: ${baseSize * 0.9}px; margin: 0 0 0.25rem 0; font-weight: 500;">Welcome, ${currentUser.full_name}</p>
                ${isAdmin ? `<p style="font-size: ${baseSize * 0.8}px; margin: 0 0 0.5rem 0; color: ${primaryColor}; font-weight: 600;">üîë Administrator</p>` : ''}
                <button onclick="handleLogout()" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid ${secondaryColor}; color: ${textColor}; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 500; cursor: pointer; font-family: ${fontFamily};">
                  Logout
                </button>
              </div>
            </div>
          </header>

          <nav style="background: ${surfaceColor}; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); padding: 0 1rem;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; gap: 0.5rem; overflow-x: auto;">
              ${isAdmin ? `
                <button class="tab-button" onclick="switchTab('admin')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'admin' ? backgroundColor : 'transparent'}; color: ${currentTab === 'admin' ? primaryColor : textColor}; font-weight: ${currentTab === 'admin' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'admin' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                  ‚öôÔ∏è Admin Dashboard
                </button>
              ` : ''}
              <button class="tab-button" onclick="switchTab('complaints')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'complaints' ? backgroundColor : 'transparent'}; color: ${currentTab === 'complaints' ? primaryColor : textColor}; font-weight: ${currentTab === 'complaints' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'complaints' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üìã Complaints
              </button>
              ${!isAdmin ? `
                <button class="tab-button" onclick="switchTab('submit')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'submit' ? backgroundColor : 'transparent'}; color: ${currentTab === 'submit' ? primaryColor : textColor}; font-weight: ${currentTab === 'submit' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'submit' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                  ‚ûï Submit
                </button>
              ` : ''}
              <button class="tab-button" onclick="switchTab('announcements')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'announcements' ? backgroundColor : 'transparent'}; color: ${currentTab === 'announcements' ? primaryColor : textColor}; font-weight: ${currentTab === 'announcements' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'announcements' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üì¢ Announcements
              </button>
              <button class="tab-button" onclick="switchTab('officials')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'officials' ? backgroundColor : 'transparent'}; color: ${currentTab === 'officials' ? primaryColor : textColor}; font-weight: ${currentTab === 'officials' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'officials' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üë• Officials
              </button>
              <button class="tab-button" onclick="switchTab('hotlines')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'hotlines' ? backgroundColor : 'transparent'}; color: ${currentTab === 'hotlines' ? primaryColor : textColor}; font-weight: ${currentTab === 'hotlines' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'hotlines' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üö® Emergency
              </button>
            </div>
          </nav>

          <main style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
            ${currentTab === 'admin' && isAdmin ? renderAdminDashboard(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) : ''}
            ${currentTab === 'complaints' ? renderComplaintsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, sortedComplaints) : ''}
            ${currentTab === 'submit' ? renderSubmitTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, formTitle, submitButtonText) : ''}
            ${currentTab === 'announcements' ? renderAnnouncementsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbAnnouncements) : ''}
            ${currentTab === 'officials' ? renderOfficialsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbOfficials) : ''}
            ${currentTab === 'hotlines' ? renderHotlinesTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbHotlines, isAdmin) : ''}
          </main>
        </div>
      `;

      document.getElementById('app').innerHTML = appHtml;
      attachEventListeners();
      
      if (currentTab === 'admin' && adminTab === 'reports') {
        setTimeout(() => {
          const reportData = generateReportData();
          drawPieChart('report-chart', reportData);
        }, 100);
      }
    }

    // [ALL YOUR EXISTING RENDER FUNCTIONS GO HERE - I'm keeping them exactly as they were in your original code]
    // Due to character limits, I'll note that you should keep ALL the render functions from your original code:
    // - renderAdminDashboard
    // - renderAdminComplaints
    // - renderReportsTab
    // - renderAdminAnnouncements
    // - renderAdminOfficials
    // - renderAdminHotlines
    // - renderComplaintsTab
    // - renderSubmitTab
    // - renderAnnouncementsTab
    // - renderOfficialsTab
    // - renderHotlinesTab

    // [Paste all your render functions here from the original code]

    function attachEventListeners() {
      if (currentTab === 'submit') {
        const form = document.getElementById('complaint-form');
        if (form) {
          form.addEventListener('submit', handleComplaintSubmit);
        }
      }

      if (currentTab === 'admin' && currentUser && currentUser.user_type === 'admin') {
        if (adminTab === 'announcements') {
          const announcementForm = document.getElementById('announcement-form');
          if (announcementForm) {
            announcementForm.addEventListener('submit', handleAnnouncementSubmit);
          }
        } else if (adminTab === 'officials') {
          const officialForm = document.getElementById('official-form');
          if (officialForm) {
            officialForm.addEventListener('submit', handleOfficialSubmit);
          }
        } else if (adminTab === 'hotlines') {
          const hotlineForm = document.getElementById('hotline-form');
          if (hotlineForm) {
            hotlineForm.addEventListener('submit', handleHotlineSubmit);
          }
        }
      }
    }

    function switchTab(tab) {
      currentTab = tab;
      renderUI();
    }

    function switchAuthMode(mode) {
      authMode = mode;
      renderUI();
    }

    function switchUserType(type) {
      userType = type;
      renderUI();
    }

    function switchAdminTab(tab) {
      adminTab = tab;
      editingAnnouncement = null;
      editingOfficial = null;
      editingHotline = null;
      renderUI();
    }

    function setStatusFilter(filter) {
      statusFilter = filter;
      renderUI();
    }

    function setCategoryFilter(filter) {
      categoryFilter = filter;
      renderUI();
    }

    function setDateFilter(filter) {
      dateFilter = filter;
      if (filter !== 'custom') {
        startDate = '';
        endDate = '';
      }
      renderUI();
    }

    function setStartDate(date) {
      startDate = date;
      renderUI();
    }

    function setEndDate(date) {
      endDate = date;
      renderUI();
    }

    function setReportStatusFilter(filter) {
      reportStatusFilter = filter;
      renderUI();
    }

    function setReportDateFilter(filter) {
      reportDateFilter = filter;
      if (filter !== 'custom') {
        reportStartDate = '';
        reportEndDate = '';
      }
      renderUI();
    }

    function setReportStartDate(date) {
      reportStartDate = date;
      renderUI();
    }

    function setReportEndDate(date) {
      reportEndDate = date;
      renderUI();
    }

    window.switchTab = switchTab;
    window.switchAuthMode = switchAuthMode;
    window.switchUserType = switchUserType;
    window.switchAdminTab = switchAdminTab;
    window.setStatusFilter = setStatusFilter;
    window.setCategoryFilter = setCategoryFilter;
    window.setDateFilter = setDateFilter;
    window.setStartDate = setStartDate;
    window.setEndDate = setEndDate;
    window.setReportStatusFilter = setReportStatusFilter;
    window.setReportDateFilter = setReportDateFilter;
    window.setReportStartDate = setReportStartDate;
    window.setReportEndDate = setReportEndDate;
    window.handleUpvote = handleUpvote;
    window.handleLogout = handleLogout;
    window.handleStatusUpdate = handleStatusUpdate;
    window.handleDeleteAnnouncement = handleDeleteAnnouncement;
    window.handleDeleteOfficial = handleDeleteOfficial;
    window.handleDeleteHotline = handleDeleteHotline;
    window.startEditAnnouncement = startEditAnnouncement;
    window.cancelEditAnnouncement = cancelEditAnnouncement;
    window.startEditOfficial = startEditOfficial;
    window.cancelEditOfficial = cancelEditOfficial;
    window.startEditHotline = startEditHotline;
    window.cancelEditHotline = cancelEditHotline;

    // Initialize data from Google Sheets
    (async function init() {
      if (GOOGLE_SCRIPT_URL === 'https://script.google.com/macros/s/AKfycbzPDOWWWqTLcm_YzidaYM3wXj33OpyLY0NGbZN53zYIjM6oT_ZPnxLTL7S3ylZQck8/exec') {
        document.getElementById('app').innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; padding: 2rem; text-align: center; font-family: system-ui, sans-serif;">
            <div>
              <h1 style="font-size: 2rem; margin-bottom: 1rem; color: #ef4444;">‚ö†Ô∏è Configuration Required</h1>
              <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">Please update the <strong>GOOGLE_SCRIPT_URL</strong> variable in the HTML file.</p>
              <p style="color: #64748b;">Find the line that says <code>const GOOGLE_SCRIPT_URL = 'PASTE_YOUR_WEB_APP_URL_HERE';</code> and replace it with your Google Apps Script Web App URL.</p>
            </div>
          </div>
        `;
        return;
      }
      
      allRecords = await loadData();
      renderUI();
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a6ed20eb751bc5b',t:'MTc2NDU1MjY0MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
