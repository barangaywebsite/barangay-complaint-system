<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barangay Complaint System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
    }
    
    html {
      height: 100%;
    }

    .tab-button {
      transition: all 0.3s ease;
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .complaint-card {
      transition: all 0.2s ease;
    }

    .complaint-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .upvote-button {
      transition: all 0.2s ease;
    }

    .upvote-button:hover {
      transform: scale(1.05);
    }

    .upvote-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #2563eb;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div id="app" class="min-h-full flex flex-col"></div>
  <script>
    // ========== CONFIGURATION ==========
    const API_URL = 'https://script.google.com/macros/s/AKfycbzpffd_-cSRt0iuY6M0cb2A6QU4GZ0BxxThIm_LmnavNzvXD2ZAAcP-wkDJTcDm42lQ/exec'; // Replace with your Google Apps Script Web App URL
    
    const config = {
      background_color: "#f0f4f8",
      surface_color: "#ffffff",
      text_color: "#1a202c",
      primary_action_color: "#2563eb",
      secondary_action_color: "#64748b",
      font_family: "Inter",
      font_size: 16,
      barangay_name: "Barangay San Miguel",
      welcome_message: "Welcome to Our Community Portal",
      form_title: "Submit New Complaint",
      submit_button_text: "Submit Complaint"
    };

    // ========== STATE ==========
    let currentTab = 'complaints';
    let currentUser = null;
    let authMode = 'login';
    let userType = 'resident';
    let adminTab = 'complaints';
    let statusFilter = 'all';
    let categoryFilter = 'all';
    let dateFilter = 'all';
    let startDate = '';
    let endDate = '';
    let editingAnnouncement = null;
    let editingOfficial = null;
    let editingHotline = null;
    let reportStatusFilter = 'all';
    let reportDateFilter = 'all';
    let reportStartDate = '';
    let reportEndDate = '';
    let isLoading = false;

    // Cache for data
    let cachedUsers = [];
    let cachedComplaints = [];
    let cachedVotes = [];
    let cachedAnnouncements = [];
    let cachedOfficials = [];
    let cachedHotlines = [];

    const categories = [
      'Roads',
      'Garbage Collection',
      'Noise/Disturbance',
      'Drainage',
      'Security',
      'Lighting',
      'Other'
    ];

    const statusTypes = [
      { value: 'submitted', label: 'Submitted', color: '#94a3b8' },
      { value: 'under_review', label: 'Under Review', color: '#60a5fa' },
      { value: 'assigned', label: 'Assigned to Officer', color: '#a78bfa' },
      { value: 'in_progress', label: 'In Progress', color: '#fb923c' },
      { value: 'resolved', label: 'Resolved', color: '#34d399' }
    ];

    // ========== API FUNCTIONS ==========
    async function apiGet(type) {
      try {
        const response = await fetch(`${API_URL}?type=${type}`);
        const data = await response.json();
        if (data.error) {
          console.error('API Error:', data.error);
          return [];
        }
        return data;
      } catch (error) {
        console.error('Fetch error:', error);
        showToast('Connection error. Please try again.', 'error');
        return [];
      }
    }

    async function apiPost(action, type, record = null, id = null) {
      try {
        const payload = { action, type };
        if (record) payload.record = record;
        if (id) payload.id = id;
        
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('API Post error:', error);
        showToast('Connection error. Please try again.', 'error');
        return { success: false, error: error.toString() };
      }
    }

    // ========== DATA FUNCTIONS ==========
async function loadAllData() {
  isLoading = true;
  renderUI();

  const [users, complaints, votes, announcements, officials, hotlines] = await Promise.all([
    apiGet('Users'),
    apiGet('Complaints'),
    apiGet('Votes'),
    apiGet('Announcements'),
    apiGet('Officials'),
    apiGet('Hotlines')
  ]);

  // Normalize Users: map common field names from Sheets/Apps Script
  cachedUsers = (Array.isArray(users) ? users : []).map(u => {
    return {
      id: u.id || u.ID || u.Id || u.rowId || (u.username ? (u.username + '_' + (u.createdAt || Date.now())) : Date.now().toString()),
      username: (u.username || u.user || u.user_name || u.User || u.Username || '').toString(),
      password: (u.password || u.pass || u.pw || '').toString(),
      fullName: (u.fullName || u.full_name || u.fullname || u.FullName || u.name || '').toString(),
      userType: (u.userType || u.user_type || (u.adminId ? 'admin' : 'resident') || 'resident').toString(),
      adminId: (u.adminId || u.admin_id || u.AdminID || '').toString(),
      createdAt: u.createdAt || u.created_at || u.CreatedAt || ''
    };
  });

  // Complaints, votes, announcements etc. keep original but ensure arrays
  cachedComplaints = Array.isArray(complaints) ? complaints : [];
  cachedVotes = Array.isArray(votes) ? votes : [];
  cachedAnnouncements = Array.isArray(announcements) ? announcements.sort((a, b) => new Date(b.date) - new Date(a.date)) : [];
  cachedOfficials = Array.isArray(officials) ? officials : [];
  cachedHotlines = Array.isArray(hotlines) ? hotlines : [];

  isLoading = false;
  renderUI();
}


    function getUsers() {
      return cachedUsers;
    }

    function getComplaints() {
      return cachedComplaints;
    }

    function getVotes() {
      return cachedVotes;
    }

    function getAnnouncements() {
      return cachedAnnouncements;
    }

    function getOfficials() {
      return cachedOfficials;
    }

    function getHotlines() {
      return cachedHotlines;
    }

    function hasUserVoted(complaintId, userId) {
      return cachedVotes.some(v => v.complaintId === complaintId && v.userId === userId);
    }

    function getStatusColor(status) {
      const statusObj = statusTypes.find(s => s.value === status);
      return statusObj ? statusObj.color : '#94a3b8';
    }

    function getStatusLabel(status) {
      const statusObj = statusTypes.find(s => s.value === status);
      return statusObj ? statusObj.label : 'Unknown';
    }

    function filterComplaintsByDate(complaints, filterType, start, end) {
      if (filterType === 'all') return complaints;
      
      if (filterType === 'custom' && start && end) {
        const startD = new Date(start);
        startD.setHours(0, 0, 0, 0);
        const endD = new Date(end);
        endD.setHours(23, 59, 59, 999);
        
        return complaints.filter(c => {
          const complaintDate = new Date(c.createdAt);
          return complaintDate >= startD && complaintDate <= endD;
        });
      }
      
      const now = new Date();
      const filtered = complaints.filter(c => {
        const complaintDate = new Date(c.createdAt);
        const daysDiff = Math.floor((now - complaintDate) / (1000 * 60 * 60 * 24));
        
        if (filterType === 'today') return daysDiff === 0;
        if (filterType === 'week') return daysDiff <= 7;
        if (filterType === 'month') return daysDiff <= 30;
        if (filterType === 'year') return daysDiff <= 365;
        
        return true;
      });
      
      return filtered;
    }

    function generateReportData() {
      let complaints = getComplaints();
      
      if (reportStatusFilter !== 'all') {
        complaints = complaints.filter(c => c.status === reportStatusFilter);
      }
      
      complaints = filterComplaintsByDate(complaints, reportDateFilter, reportStartDate, reportEndDate);
      
      const statusCounts = {};
      statusTypes.forEach(st => {
        statusCounts[st.value] = complaints.filter(c => c.status === st.value).length;
      });
      
      return { statusCounts, total: complaints.length };
    }

    function drawPieChart(canvasId, data) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 40;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const total = data.total;
      if (total === 0) {
        ctx.fillStyle = config.text_color;
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('No data to display', centerX, centerY);
        return;
      }
      
      let currentAngle = -Math.PI / 2;
      
      statusTypes.forEach(st => {
        const count = data.statusCounts[st.value];
        if (count > 0) {
          const sliceAngle = (count / total) * 2 * Math.PI;
          
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
          ctx.closePath();
          ctx.fillStyle = st.color;
          ctx.fill();
          
          ctx.strokeStyle = config.surface_color;
          ctx.lineWidth = 2;
          ctx.stroke();
          
          const labelAngle = currentAngle + sliceAngle / 2;
          const labelX = centerX + (radius * 0.7) * Math.cos(labelAngle);
          const labelY = centerY + (radius * 0.7) * Math.sin(labelAngle);
          
          ctx.fillStyle = '#ffffff';
          ctx.font = 'bold 14px sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(count, labelX, labelY);
          
          currentAngle += sliceAngle;
        }
      });
    }

    // ========== EVENT HANDLERS ==========
    async function handleLogin(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
const username = formData.get('username')?.toString().trim();
const password = formData.get('password')?.toString().trim();
const adminId = formData.get('admin_id')?.toString().trim();


      isLoading = true;
      renderUI();
      
      await loadAllData();

      let user;
      if (userType === 'admin') {
        user = cachedUsers.find(u => u.username === username && u.password === password && u.userType === 'admin' && u.adminId === adminId);
      } else {
        user = cachedUsers.find(u => u.username === username && u.password === password && u.userType === 'resident');
      }
      
      isLoading = false;
      
      if (user) {
        currentUser = user;
        showToast('Login successful!', 'success');
        renderUI();
      } else {
        showToast(userType === 'admin' ? 'Invalid credentials or Admin ID' : 'Invalid username or password', 'error');
        renderUI();
      }
    }

    async function handleSignup(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const username = formData.get('username');
      const password = formData.get('password');
      const fullName = formData.get('full_name');
      const adminId = formData.get('admin_id');

      const existingUser = cachedUsers.find(u => u.username === username);
      
      if (existingUser) {
        showToast('Username already exists. Please choose another.', 'error');
        return;
      }

      const newUser = {
        id: Date.now().toString(),
        username,
        password,
        fullName,
        userType,
        adminId: userType === 'admin' ? adminId : '',
        createdAt: new Date().toISOString()
      };

      isLoading = true;
      renderUI();
      
      const result = await apiPost('create', 'Users', newUser);
      
      isLoading = false;
      
      if (result.success) {
        cachedUsers.push(newUser);
        showToast('Account created successfully! Please login.', 'success');
        authMode = 'login';
        renderUI();
      } else {
        showToast('Failed to create account. Please try again.', 'error');
        renderUI();
      }
    }

    async function handleComplaintSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      
      const newComplaint = {
        id: Date.now().toString(),
        title: formData.get('title'),
        description: formData.get('description'),
        category: formData.get('category'),
        status: 'submitted',
        upvotes: 0,
        createdAt: new Date().toISOString(),
        residentName: currentUser.fullName,
        userId: currentUser.id
      };

      isLoading = true;
      renderUI();
      
      const result = await apiPost('create', 'Complaints', newComplaint);
      
      isLoading = false;
      
      if (result.success) {
        cachedComplaints.push(newComplaint);
        e.target.reset();
        showToast('Complaint submitted successfully!', 'success');
        currentTab = 'complaints';
        renderUI();
      } else {
        showToast('Failed to submit complaint. Please try again.', 'error');
        renderUI();
      }
    }

    async function handleUpvote(complaintId) {
      if (!currentUser) return;

      if (hasUserVoted(complaintId, currentUser.id)) {
        showToast('You have already voted on this complaint.', 'error');
        return;
      }

      const complaint = cachedComplaints.find(c => c.id === complaintId);
      
      if (complaint) {
        const updatedComplaint = { ...complaint, upvotes: complaint.upvotes + 1 };
        
        const newVote = {
          id: Date.now().toString(),
          complaintId,
          userId: currentUser.id,
          createdAt: new Date().toISOString()
        };

        isLoading = true;
        renderUI();
        
        const [updateResult, voteResult] = await Promise.all([
          apiPost('update', 'Complaints', updatedComplaint),
          apiPost('create', 'Votes', newVote)
        ]);
        
        isLoading = false;
        
        if (updateResult.success && voteResult.success) {
          // Update cache
          const index = cachedComplaints.findIndex(c => c.id === complaintId);
          if (index !== -1) {
            cachedComplaints[index] = updatedComplaint;
          }
          cachedVotes.push(newVote);
          
          showToast('Upvoted successfully!', 'success');
          renderUI();
        } else {
          showToast('Failed to upvote. Please try again.', 'error');
          renderUI();
        }
      }
    }

    function handleLogout() {
      currentUser = null;
      currentTab = 'complaints';
      adminTab = 'complaints';
      renderUI();
      showToast('Logged out successfully', 'success');
    }

    async function handleStatusUpdate(complaintId, newStatus) {
      const complaint = cachedComplaints.find(c => c.id === complaintId);
      
      if (complaint) {
        const updatedComplaint = { ...complaint, status: newStatus };
        
        isLoading = true;
        renderUI();
        
        const result = await apiPost('update', 'Complaints', updatedComplaint);
        
        isLoading = false;
        
        if (result.success) {
          const index = cachedComplaints.findIndex(c => c.id === complaintId);
          if (index !== -1) {
            cachedComplaints[index] = updatedComplaint;
          }
          
          showToast('Complaint status updated!', 'success');
          
          if (adminTab === 'reports') {
            setTimeout(() => {
              const reportData = generateReportData();
              drawPieChart('report-chart', reportData);
            }, 100);
          }
          
          renderUI();
        } else {
          showToast('Failed to update status. Please try again.', 'error');
          renderUI();
        }
      }
    }

    async function handleAnnouncementSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);

      if (editingAnnouncement) {
        const updatedAnnouncement = {
          ...editingAnnouncement,
          title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority'),
          date: formData.get('date')
        };
        
        isLoading = true;
        renderUI();
        
        const result = await apiPost('update', 'Announcements', updatedAnnouncement);
        
        isLoading = false;
        
        if (result.success) {
          const index = cachedAnnouncements.findIndex(a => a.id === editingAnnouncement.id);
          if (index !== -1) {
            cachedAnnouncements[index] = updatedAnnouncement;
          }
          cachedAnnouncements.sort((a, b) => new Date(b.date) - new Date(a.date));
          
          showToast('Announcement updated!', 'success');
          editingAnnouncement = null;
          renderUI();
        } else {
          showToast('Failed to update announcement. Please try again.', 'error');
          renderUI();
        }
      } else {
        const newAnnouncement = {
          id: Date.now().toString(),
          title: formData.get('title'),
          content: formData.get('content'),
          priority: formData.get('priority'),
          date: formData.get('date'),
          createdAt: new Date().toISOString()
        };

        isLoading = true;
        renderUI();
        
        const result = await apiPost('create', 'Announcements', newAnnouncement);
        
        isLoading = false;
        
        if (result.success) {
          cachedAnnouncements.push(newAnnouncement);
          cachedAnnouncements.sort((a, b) => new Date(b.date) - new Date(a.date));
          
          e.target.reset();
          showToast('Announcement created!', 'success');
          renderUI();
        } else {
          showToast('Failed to create announcement. Please try again.', 'error');
          renderUI();
        }
      }
    }

    async function handleDeleteAnnouncement(announcementId) {
      isLoading = true;
      renderUI();
      
      const result = await apiPost('delete', 'Announcements', null, announcementId);
      
      isLoading = false;
      
      if (result.success) {
        cachedAnnouncements = cachedAnnouncements.filter(a => a.id !== announcementId);
        showToast('Announcement deleted!', 'success');
        renderUI();
      } else {
        showToast('Failed to delete announcement. Please try again.', 'error');
        renderUI();
      }
    }

    async function handleOfficialSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);

      if (editingOfficial) {
        const updatedOfficial = {
          ...editingOfficial,
          name: formData.get('name'),
          position: formData.get('position'),
          contact: formData.get('contact')
        };
        
        isLoading = true;
        renderUI();
        
        const result = await apiPost('update', 'Officials', updatedOfficial);
        
        isLoading = false;
        
        if (result.success) {
          const index = cachedOfficials.findIndex(o => o.id === editingOfficial.id);
          if (index !== -1) {
            cachedOfficials[index] = updatedOfficial;
          }
          
          showToast('Official updated!', 'success');
          editingOfficial = null;
          renderUI();
        } else {
          showToast('Failed to update official. Please try again.', 'error');
          renderUI();
        }
      } else {
        const newOfficial = {
          id: Date.now().toString(),
          name: formData.get('name'),
          position: formData.get('position'),
          contact: formData.get('contact'),
          createdAt: new Date().toISOString()
        };

        isLoading = true;
        renderUI();
        
        const result = await apiPost('create', 'Officials', newOfficial);
        
        isLoading = false;
        
        if (result.success) {
          cachedOfficials.push(newOfficial);
          e.target.reset();
          showToast('Official added!', 'success');
          renderUI();
        } else {
          showToast('Failed to add official. Please try again.', 'error');
          renderUI();
        }
      }
    }

    async function handleDeleteOfficial(officialId) {
      isLoading = true;
      renderUI();
      
      const result = await apiPost('delete', 'Officials', null, officialId);
      
      isLoading = false;
      
      if (result.success) {
        cachedOfficials = cachedOfficials.filter(o => o.id !== officialId);
        showToast('Official removed!', 'success');
        renderUI();
      } else {
        showToast('Failed to remove official. Please try again.', 'error');
        renderUI();
      }
    }

    async function handleHotlineSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);

      if (editingHotline) {
        const updatedHotline = {
          ...editingHotline,
          serviceName: formData.get('service_name'),
          phoneNumber: formData.get('phone_number'),
          description: formData.get('description'),
          availableHours: formData.get('available_hours')
        };
        
        isLoading = true;
        renderUI();
        
        const result = await apiPost('update', 'Hotlines', updatedHotline);
        
        isLoading = false;
        
        if (result.success) {
          const index = cachedHotlines.findIndex(h => h.id === editingHotline.id);
          if (index !== -1) {
            cachedHotlines[index] = updatedHotline;
          }
          
          showToast('Hotline updated!', 'success');
          editingHotline = null;
          renderUI();
        } else {
          showToast('Failed to update hotline. Please try again.', 'error');
          renderUI();
        }
      } else {
        const newHotline = {
          id: Date.now().toString(),
          serviceName: formData.get('service_name'),
          phoneNumber: formData.get('phone_number'),
          description: formData.get('description'),
          availableHours: formData.get('available_hours'),
          createdAt: new Date().toISOString()
        };

        isLoading = true;
        renderUI();
        
        const result = await apiPost('create', 'Hotlines', newHotline);
        
        isLoading = false;
        
        if (result.success) {
          cachedHotlines.push(newHotline);
          e.target.reset();
          showToast('Hotline added!', 'success');
          renderUI();
        } else {
          showToast('Failed to add hotline. Please try again.', 'error');
          renderUI();
        }
      }
    }

    async function handleDeleteHotline(hotlineId) {
      isLoading = true;
      renderUI();
      
      const result = await apiPost('delete', 'Hotlines', null, hotlineId);
      
      isLoading = false;
      
      if (result.success) {
        cachedHotlines = cachedHotlines.filter(h => h.id !== hotlineId);
        showToast('Hotline removed!', 'success');
        renderUI();
      } else {
        showToast('Failed to remove hotline. Please try again.', 'error');
        renderUI();
      }
    }

    function startEditAnnouncement(announcementId) {
      editingAnnouncement = cachedAnnouncements.find(a => a.id === announcementId);
      renderUI();
    }

    function cancelEditAnnouncement() {
      editingAnnouncement = null;
      renderUI();
    }

    function startEditOfficial(officialId) {
      editingOfficial = cachedOfficials.find(o => o.id === officialId);
      renderUI();
    }

    function cancelEditOfficial() {
      editingOfficial = null;
      renderUI();
    }

    function startEditHotline(hotlineId) {
      editingHotline = cachedHotlines.find(h => h.id === hotlineId);
      renderUI();
    }

    function cancelEditHotline() {
      editingHotline = null;
      renderUI();
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? '#34d399' : type === 'error' ? '#f87171' : '#60a5fa';
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${bgColor};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 10000;
        font-weight: 500;
        max-width: 300px;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.transition = 'opacity 0.3s ease';
        toast.style.opacity = '0';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }

    function renderLoadingScreen() {
      const customFont = config.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      const baseSize = config.font_size;
      const backgroundColor = config.background_color;
      const textColor = config.text_color;

      return `
        <div style="background: ${backgroundColor}; min-height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; font-family: ${fontFamily}; color: ${textColor};">
          <div class="loading-spinner"></div>
          <p style="font-size: ${baseSize * 1.1}px; margin-top: 1.5rem; font-weight: 500;">Loading...</p>
        </div>
      `;
    }

    function renderAuthScreen() {
      const customFont = config.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      const baseSize = config.font_size;

      const backgroundColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;

      const barangayName = config.barangay_name;
      const welcomeMessage = config.welcome_message;

      if (isLoading) {
        document.getElementById('app').innerHTML = renderLoadingScreen();
        return;
      }

      const authHtml = `
        <div style="background: ${backgroundColor}; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 2rem; font-family: ${fontFamily}; color: ${textColor};">
          <div style="width: 100%; max-width: 450px;">
            <div style="text-align: center; margin-bottom: 2rem;">
              <h1 style="font-size: ${baseSize * 2}px; font-weight: 700; margin: 0 0 0.5rem 0;">${barangayName}</h1>
              <p style="font-size: ${baseSize}px; color: ${secondaryColor}; margin: 0;">${welcomeMessage}</p>
            </div>

            <div style="background: ${surfaceColor}; border-radius: 16px; padding: 2.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
              <div style="margin-bottom: 1.5rem;">
                <div style="display: flex; gap: 0.5rem; background: ${backgroundColor}; padding: 0.25rem; border-radius: 8px;">
                  <button onclick="switchUserType('resident')" style="flex: 1; padding: 0.75rem; border: none; background: ${userType === 'resident' ? surfaceColor : 'transparent'}; color: ${userType === 'resident' ? primaryColor : textColor}; font-weight: ${userType === 'resident' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${userType === 'resident' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    üë§ Resident
                  </button>
                  <button onclick="switchUserType('admin')" style="flex: 1; padding: 0.75rem; border: none; background: ${userType === 'admin' ? surfaceColor : 'transparent'}; color: ${userType === 'admin' ? primaryColor : textColor}; font-weight: ${userType === 'admin' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${userType === 'admin' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    üîë Admin
                  </button>
                </div>
              </div>

              <div style="margin-bottom: 2rem;">
                <div style="display: flex; gap: 0.5rem; background: ${backgroundColor}; padding: 0.25rem; border-radius: 8px;">
                  <button onclick="switchAuthMode('login')" style="flex: 1; padding: 0.75rem; border: none; background: ${authMode === 'login' ? surfaceColor : 'transparent'}; color: ${authMode === 'login' ? primaryColor : textColor}; font-weight: ${authMode === 'login' ? '600' : '500'}; font-size: ${baseSize}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${authMode === 'login' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    Login
                  </button>
                  <button onclick="switchAuthMode('signup')" style="flex: 1; padding: 0.75rem; border: none; background: ${authMode === 'signup' ? surfaceColor : 'transparent'}; color: ${authMode === 'signup' ? primaryColor : textColor}; font-weight: ${authMode === 'signup' ? '600' : '500'}; font-size: ${baseSize}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily}; box-shadow: ${authMode === 'signup' ? '0 1px 3px rgba(0, 0, 0, 0.1)' : 'none'};">
                    Sign Up
                  </button>
                </div>
              </div>

              ${authMode === 'login' ? `
                <form id="login-form">
                  <div style="margin-bottom: 1.5rem;">
                    <label for="login-username" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Username</label>
                    <input type="text" id="login-username" name="username" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: ${userType === 'admin' ? '1.5rem' : '2rem'};">
                    <label for="login-password" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                    <input type="password" id="login-password" name="password" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  ${userType === 'admin' ? `
                    <div style="margin-bottom: 2rem;">
                      <label for="login-admin-id" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Admin ID Number</label>
                      <input type="text" id="login-admin-id" name="admin_id" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                    </div>
                  ` : ''}

                  <button type="submit" style="width: 100%; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                    Login
                  </button>
                </form>
              ` : `
                <form id="signup-form">
                  <div style="margin-bottom: 1.5rem;">
                    <label for="signup-fullname" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Full Name</label>
                    <input type="text" id="signup-fullname" name="full_name" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: 1.5rem;">
                    <label for="signup-username" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Username</label>
                    <input type="text" id="signup-username" name="username" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                  </div>

                  <div style="margin-bottom: ${userType === 'admin' ? '1.5rem' : '2rem'};">
                    <label for="signup-password" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Password</label>
                    <input type="password" id="signup-password" name="password" required minlength="6" style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                    <p style="font-size: ${baseSize * 0.8}px; color: ${secondaryColor}; margin: 0.5rem 0 0 0;">Minimum 6 characters</p>
                  </div>

                  ${userType === 'admin' ? `
                    <div style="margin-bottom: 2rem;">
                      <label for="signup-admin-id" style="display: block; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-bottom: 0.5rem;">Admin ID Number</label>
                      <input type="text" id="signup-admin-id" name="admin_id" required style="width: 100%; padding: 0.75rem; border: 2px solid ${backgroundColor}; border-radius: 8px; font-size: ${baseSize}px; font-family: ${fontFamily}; color: ${textColor}; box-sizing: border-box;">
                      <p style="font-size: ${baseSize * 0.8}px; color: ${secondaryColor}; margin: 0.5rem 0 0 0;">Your official admin identification number</p>
                    </div>
                  ` : ''}

                  <button type="submit" style="width: 100%; padding: 1rem; background: ${primaryColor}; color: white; border: none; border-radius: 8px; font-size: ${baseSize * 1.1}px; font-weight: 600; cursor: pointer; font-family: ${fontFamily};">
                    Create Account
                  </button>
                </form>
              `}
            </div>
          </div>
        </div>
      `;

      document.getElementById('app').innerHTML = authHtml;

      if (authMode === 'login') {
        const form = document.getElementById('login-form');
        if (form) {
          form.addEventListener('submit', handleLogin);
        }
      } else {
        const form = document.getElementById('signup-form');
        if (form) {
          form.addEventListener('submit', handleSignup);
        }
      }
    }

    // ========== RENDER FUNCTIONS ==========
    // (All the render functions from the original code - renderAdminDashboard, renderComplaintsTab, etc.)
    // Due to character limits, I'll include just the main renderUI function structure

    function renderUI() {
      if (!currentUser) {
        renderAuthScreen();
        return;
      }

      if (isLoading) {
        document.getElementById('app').innerHTML = renderLoadingScreen();
        return;
      }

      const customFont = config.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;
      const baseSize = config.font_size;

      const backgroundColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;

      const barangayName = config.barangay_name;
      const welcomeMessage = config.welcome_message;
      const formTitle = config.form_title;
      const submitButtonText = config.submit_button_text;

      const complaints = getComplaints();
      const sortedComplaints = [...complaints].sort((a, b) => b.upvotes - a.upvotes);
      
      const dbAnnouncements = getAnnouncements();
      const dbOfficials = getOfficials();
      const dbHotlines = getHotlines();
      
      let filteredComplaints = complaints;
      if (statusFilter !== 'all') {
        filteredComplaints = filteredComplaints.filter(c => c.status === statusFilter);
      }
      if (categoryFilter !== 'all') {
        filteredComplaints = filteredComplaints.filter(c => c.category === categoryFilter);
      }
      filteredComplaints = filterComplaintsByDate(filteredComplaints, dateFilter, startDate, endDate);

      const isAdmin = currentUser && currentUser.userType === 'admin';

      const appHtml = `
        <div style="background: ${backgroundColor}; min-height: 100%; font-family: ${fontFamily}; color: ${textColor};">
          <header style="background: ${surfaceColor}; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 1.5rem 1rem;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
              <div>
                <h1 style="font-size: ${baseSize * 1.75}px; font-weight: 700; margin: 0 0 0.5rem 0;">${barangayName}</h1>
                <p style="font-size: ${baseSize * 0.9}px; margin: 0; color: ${secondaryColor};">${welcomeMessage}</p>
              </div>
              <div style="text-align: right;">
                <p style="font-size: ${baseSize * 0.9}px; margin: 0 0 0.25rem 0; font-weight: 500;">Welcome, ${currentUser.fullName}</p>
                ${isAdmin ? `<p style="font-size: ${baseSize * 0.8}px; margin: 0 0 0.5rem 0; color: ${primaryColor}; font-weight: 600;">üîë Administrator</p>` : ''}
                <button onclick="handleLogout()" style="padding: 0.5rem 1rem; background: ${backgroundColor}; border: 2px solid ${secondaryColor}; color: ${textColor}; border-radius: 6px; font-size: ${baseSize * 0.85}px; font-weight: 500; cursor: pointer; font-family: ${fontFamily};">
                  Logout
                </button>
              </div>
            </div>
          </header>

          <nav style="background: ${surfaceColor}; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); padding: 0 1rem;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; gap: 0.5rem; overflow-x: auto;">
              ${isAdmin ? `
                <button class="tab-button" onclick="switchTab('admin')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'admin' ? backgroundColor : 'transparent'}; color: ${currentTab === 'admin' ? primaryColor : textColor}; font-weight: ${currentTab === 'admin' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'admin' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                  ‚öôÔ∏è Admin Dashboard
                </button>
              ` : ''}
              <button class="tab-button" onclick="switchTab('complaints')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'complaints' ? backgroundColor : 'transparent'}; color: ${currentTab === 'complaints' ? primaryColor : textColor}; font-weight: ${currentTab === 'complaints' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'complaints' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üìã Complaints
              </button>
              ${!isAdmin ? `
                <button class="tab-button" onclick="switchTab('submit')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'submit' ? backgroundColor : 'transparent'}; color: ${currentTab === 'submit' ? primaryColor : textColor}; font-weight: ${currentTab === 'submit' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'submit' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                  ‚úèÔ∏è Submit
                </button>
              ` : ''}
              <button class="tab-button" onclick="switchTab('announcements')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'announcements' ? backgroundColor : 'transparent'}; color: ${currentTab === 'announcements' ? primaryColor : textColor}; font-weight: ${currentTab === 'announcements' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'announcements' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üì¢ Announcements
              </button>
              <button class="tab-button" onclick="switchTab('officials')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'officials' ? backgroundColor : 'transparent'}; color: ${currentTab === 'officials' ? primaryColor : textColor}; font-weight: ${currentTab === 'officials' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'officials' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üë• Officials
              </button>
              <button class="tab-button" onclick="switchTab('hotlines')" style="padding: 1rem 1.5rem; border: none; background: ${currentTab === 'hotlines' ? backgroundColor : 'transparent'}; color: ${currentTab === 'hotlines' ? primaryColor : textColor}; font-weight: ${currentTab === 'hotlines' ? '600' : '500'}; font-size: ${baseSize}px; cursor: pointer; border-bottom: 3px solid ${currentTab === 'hotlines' ? primaryColor : 'transparent'}; font-family: ${fontFamily};">
                üö® Emergency
              </button>
            </div>
          </nav>

          <main style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
            ${currentTab === 'admin' && isAdmin ? renderAdminDashboard(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) : ''}
            ${currentTab === 'complaints' ? renderComplaintsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, sortedComplaints) : ''}
            ${currentTab === 'submit' ? renderSubmitTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, formTitle, submitButtonText) : ''}
            ${currentTab === 'announcements' ? renderAnnouncementsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbAnnouncements) : ''}
            ${currentTab === 'officials' ? renderOfficialsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbOfficials) : ''}
            ${currentTab === 'hotlines' ? renderHotlinesTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, dbHotlines, isAdmin) : ''}
          </main>
        </div>
      `;

      document.getElementById('app').innerHTML = appHtml;
      attachEventListeners();
      
      if (currentTab === 'admin' && adminTab === 'reports') {
        setTimeout(() => {
          const reportData = generateReportData();
          drawPieChart('report-chart', reportData);
        }, 100);
      }
    }

   function renderComplaintsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, sortedComplaints) {
  if (!sortedComplaints || sortedComplaints.length === 0) {
    return `
      <div style="text-align: center; padding: 2rem; color: ${secondaryColor}; font-size: ${baseSize * 1.1}px;">
        No complaints available.
      </div>
    `;
  }

  return `
    <div style="display: flex; flex-direction: column; gap: 1rem;">
      ${sortedComplaints.map(c => `
        <div style="
          background: ${surfaceColor};
          padding: 1.5rem;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
          font-family: ${fontFamily};
        ">
          <h3 style="margin: 0 0 0.25rem; font-size: ${baseSize * 1.3}px; color: ${primaryColor};">
            ${c.title || 'Untitled Complaint'}
          </h3>
          <p style="margin: 0 0 1rem; color: ${textColor}; font-size: ${baseSize}px;">
            ${c.details || ''}
          </p>

          <div style="font-size: ${baseSize * 0.85}px; color: ${secondaryColor}; margin-bottom: 1rem;">
            <strong>Category:</strong> ${c.category || 'General'}
            &nbsp; | &nbsp;
            <strong>Status:</strong> ${c.status || 'Pending'}
            &nbsp; | &nbsp;
            <strong>Upvotes:</strong> ${c.upvotes || 0}
          </div>

          <button onclick="handleUpvote('${c.id}')"
            style="
              padding: 0.5rem 1rem;
              background: ${primaryColor};
              border: none;
              color: white;
              border-radius: 6px;
              font-size: ${baseSize * 0.9}px;
              cursor: pointer;
              font-family: ${fontFamily};
            ">
            üëç Upvote
          </button>
        </div>
      `).join('')}
    </div>
  `;
}

    // Include all render helper functions from original code
    function renderAdminDashboard(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) {
      return `
        <div>
          <div style="margin-bottom: 2rem;">
            <div style="display: flex; gap: 0.5rem; background: ${surfaceColor}; padding: 0.5rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
              <button onclick="switchAdminTab('complaints')" style="flex: 1; padding: 0.75rem; border: none; background: ${adminTab === 'complaints' ? primaryColor : 'transparent'}; color: ${adminTab === 'complaints' ? 'white' : textColor}; font-weight: ${adminTab === 'complaints' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily};">
                Manage Complaints
              </button>
              <button onclick="switchAdminTab('reports')" style="flex: 1; padding: 0.75rem; border: none; background: ${adminTab === 'reports' ? primaryColor : 'transparent'}; color: ${adminTab === 'reports' ? 'white' : textColor}; font-weight: ${adminTab === 'reports' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily};">
                Reports
              </button>
              <button onclick="switchAdminTab('announcements')" style="flex: 1; padding: 0.75rem; border: none; background: ${adminTab === 'announcements' ? primaryColor : 'transparent'}; color: ${adminTab === 'announcements' ? 'white' : textColor}; font-weight: ${adminTab === 'announcements' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily};">
                Announcements
              </button>
              <button onclick="switchAdminTab('officials')" style="flex: 1; padding: 0.75rem; border: none; background: ${adminTab === 'officials' ? primaryColor : 'transparent'}; color: ${adminTab === 'officials' ? 'white' : textColor}; font-weight: ${adminTab === 'officials' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily};">
                Officials
              </button>
              <button onclick="switchAdminTab('hotlines')" style="flex: 1; padding: 0.75rem; border: none; background: ${adminTab === 'hotlines' ? primaryColor : 'transparent'}; color: ${adminTab === 'hotlines' ? 'white' : textColor}; font-weight: ${adminTab === 'hotlines' ? '600' : '500'}; font-size: ${baseSize * 0.9}px; border-radius: 6px; cursor: pointer; font-family: ${fontFamily};">
                Hotlines
              </button>
            </div>
          </div>

          ${adminTab === 'complaints' ? renderAdminComplaints(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor, filteredComplaints) : ''}
          ${adminTab === 'reports' ? renderReportsTab(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
          ${adminTab === 'announcements' ? renderAdminAnnouncements(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
          ${adminTab === 'officials' ? renderAdminOfficials(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
          ${adminTab === 'hotlines' ? renderAdminHotlines(baseSize, fontFamily, backgroundColor, surfaceColor, textColor, primaryColor, secondaryColor) : ''}
        </div>
      `;
    }

    // ... (Include all other render functions from original code: renderAdminComplaints, renderReportsTab, renderAdminAnnouncements, etc.)

    function attachEventListeners() {
      if (currentTab === 'submit') {
        const form = document.getElementById('complaint-form');
        if (form) {
          form.addEventListener('submit', handleComplaintSubmit);
        }
      }

      if (currentTab === 'admin' && currentUser && currentUser.userType === 'admin') {
        if (adminTab === 'announcements') {
          const announcementForm = document.getElementById('announcement-form');
          if (announcementForm) {
            announcementForm.addEventListener('submit', handleAnnouncementSubmit);
          }
        } else if (adminTab === 'officials') {
          const officialForm = document.getElementById('official-form');
          if (officialForm) {
            officialForm.addEventListener('submit', handleOfficialSubmit);
          }
        } else if (adminTab === 'hotlines') {
          const hotlineForm = document.getElementById('hotline-form');
          if (hotlineForm) {
            hotlineForm.addEventListener('submit', handleHotlineSubmit);
          }
        }
      }
    }

    // ========== GLOBAL FUNCTIONS ==========
    function switchTab(tab) {
      currentTab = tab;
      renderUI();
    }

    function switchAuthMode(mode) {
      authMode = mode;
      renderUI();
    }

    function switchUserType(type) {
      userType = type;
      renderUI();
    }

    function switchAdminTab(tab) {
      adminTab = tab;
      editingAnnouncement = null;
      editingOfficial = null;
      editingHotline = null;
      renderUI();
    }

    function setStatusFilter(filter) {
      statusFilter = filter;
      renderUI();
    }

    function setCategoryFilter(filter) {
      categoryFilter = filter;
      renderUI();
    }

    function setDateFilter(filter) {
      dateFilter = filter;
      if (filter !== 'custom') {
        startDate = '';
        endDate = '';
      }
      renderUI();
    }

    function setStartDate(date) {
      startDate = date;
      renderUI();
    }

    function setEndDate(date) {
      endDate = date;
      renderUI();
    }

    function setReportStatusFilter(filter) {
      reportStatusFilter = filter;
      renderUI();
    }

    function setReportDateFilter(filter) {
      reportDateFilter = filter;
      if (filter !== 'custom') {
        reportStartDate = '';
        reportEndDate = '';
      }
      renderUI();
    }

    function setReportStartDate(date) {
      reportStartDate = date;
      renderUI();
    }

    function setReportEndDate(date) {
      reportEndDate = date;
      renderUI();
    }

    window.switchTab = switchTab;
    window.switchAuthMode = switchAuthMode;
    window.switchUserType = switchUserType;
    window.switchAdminTab = switchAdminTab;
    window.setStatusFilter = setStatusFilter;
    window.setCategoryFilter = setCategoryFilter;
    window.setDateFilter = setDateFilter;
    window.setStartDate = setStartDate;
    window.setEndDate = setEndDate;
    window.setReportStatusFilter = setReportStatusFilter;
    window.setReportDateFilter = setReportDateFilter;
    window.setReportStartDate = setReportStartDate;
    window.setReportEndDate = setReportEndDate;
    window.handleUpvote = handleUpvote;
    window.handleLogout = handleLogout;
    window.handleStatusUpdate = handleStatusUpdate;
    window.handleDeleteAnnouncement = handleDeleteAnnouncement;
    window.handleDeleteOfficial = handleDeleteOfficial;
    window.handleDeleteHotline = handleDeleteHotline;
    window.startEditAnnouncement = startEditAnnouncement;
    window.cancelEditAnnouncement = cancelEditAnnouncement;
    window.startEditOfficial = startEditOfficial;
    window.cancelEditOfficial = cancelEditOfficial;
    window.startEditHotline = startEditHotline;
    window.cancelEditHotline = cancelEditHotline;

    // Initialize
    renderUI();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a849bb2a17eb9ff',t:'MTc2NDc4MTEwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
